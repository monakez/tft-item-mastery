import{Y as t,d as i,v as e,r as s,s as h,x as n,y as a,z as o,Z as r,Q as d,_ as l,$ as c,T as p,c as u,a0 as _,a1 as g,n as w,U as f,R as m,W as x,P as v,a2 as y,o as b,a3 as S}from"./index-ZZ8c1FWJ.js";import{T as V,G as C,a as T}from"./GameScene-BH6c8_jx.js";import{c as P}from"./canvasUtils-Bu2bEncp.js";import"./Filter-YnUaChUR.js";const I=class n extends t{constructor(...t){let a=t[0]??{};a instanceof Float32Array&&(i(e,"use new MeshGeometry({ positions, uvs, indices }) instead"),a={positions:a,uvs:t[1],indices:t[2]}),a={...n.defaultOptions,...a};const o=a.positions||new Float32Array([0,0,1,0,1,1,0,1]);let r=a.uvs;r||(r=a.positions?new Float32Array(o.length):new Float32Array([0,0,1,0,1,1,0,1]));const d=a.indices||new Uint32Array([0,1,2,0,2,3]),l=a.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new s({data:o,label:"attribute-mesh-positions",shrinkToFit:l,usage:h.VERTEX|h.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new s({data:r,label:"attribute-mesh-uvs",shrinkToFit:l,usage:h.VERTEX|h.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new s({data:d,label:"index-mesh-buffer",shrinkToFit:l,usage:h.INDEX|h.COPY_DST}),topology:a.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};I.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let k=I;class A{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),i=t.data;let e=i;const s=this.texture.textureMatrix;return s.isSimple||(e=this._transformedUvs,this._textureMatrixUpdateId===s._updateID&&this._uvUpdateId===t._updateID||((!e||e.length<i.length)&&(e=this._transformedUvs=new Float32Array(i.length)),this._textureMatrixUpdateId=s._updateID,this._uvUpdateId=t._updateID,s.multiplyUvs(i,e))),e}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}const B=class t extends k{constructor(...t){super({});let s=t[0]??{};"number"==typeof s&&(i(e,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),s={width:s,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(s)}build(i){i={...t.defaultOptions,...i},this.verticesX=this.verticesX??i.verticesX,this.verticesY=this.verticesY??i.verticesY,this.width=this.width??i.width,this.height=this.height??i.height;const e=this.verticesX*this.verticesY,s=[],h=[],n=[],a=this.verticesX-1,o=this.verticesY-1,r=this.width/a,d=this.height/o;for(let t=0;t<e;t++){const i=t%this.verticesX,e=t/this.verticesX|0;s.push(i*r,e*d),h.push(i/a,e/o)}const l=a*o;for(let t=0;t<l;t++){const i=t%a,e=t/a|0,s=e*this.verticesX+i,h=e*this.verticesX+i+1,o=(e+1)*this.verticesX+i,r=(e+1)*this.verticesX+i+1;n.push(s,h,o,h,r,o)}this.buffers[0].data=new Float32Array(s),this.buffers[1].data=new Float32Array(h),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};B.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let M=B;class H{constructor(t){this._renderer=t}validateRenderable(t){return!1}addRenderable(t,i){this._renderer.renderPipes.batch.break(i),i.add(t)}updateRenderable(t){}execute(t){const i=this._renderer,e=i.canvasContext,s=e.activeContext;s.save();const h=t.groupTransform,o=i._roundPixels|t._roundPixels;e.setContextTransform(h,1===o),e.setBlendMode(t.groupBlendMode);const r=i.globalUniforms.globalUniformData?.worldColor??4294967295,d=t.groupColorAlpha,l=(r>>>24&255)/255*((d>>>24&255)/255)*(i.filter?.alphaMultiplier??1);if(l<=0)return void s.restore();s.globalAlpha=l;const c=n(a(16777215&d,16777215&r)),p=t.texture,u=P.getCanvasSource(p);if(!u)return void s.restore();const _=e.smoothProperty,g="nearest"!==p.source.style.scaleMode;s[_]!==g&&(s[_]=g);const w=16777215!==c||0!==p.rotate,f=w?P.getTintedCanvas({texture:p},c):u,{leftWidth:m,topHeight:x,rightWidth:v,bottomHeight:y,width:b,height:S}=t,V=m+v,C=x+y,T=Math.min(V>b?b/V:1,C>S?S/C:1,1),I=m*T,k=v*T,A=x*T,B=y*T,M=Math.max(0,b-I-k),H=Math.max(0,S-A-B),E=t.anchor,R=p.source._resolution??p.source.resolution??1;let O=p.frame.x*R,U=p.frame.y*R;const W=-E.x*b,F=-E.y*S,D=m*R,j=x*R,z=v*R,X=y*R;let Y=p.frame.width*R,N=p.frame.height*R;w&&(O=0,U=0,Y=f.width,N=f.height),s.drawImage(f,O,U,D,j,W,F,I,A),s.drawImage(f,O+D,U,Y-D-z,j,W+I,F,M,A),s.drawImage(f,O+Y-z,U,z,j,W+b-k,F,k,A),s.drawImage(f,O,U+j,D,N-j-X,W,F+A,I,H),s.drawImage(f,O+D,U+j,Y-D-z,N-j-X,W+I,F+A,M,H),s.drawImage(f,O+Y-z,U+j,z,N-j-X,W+b-k,F+A,k,H),s.drawImage(f,O,U+N-X,D,X,W,F+S-B,I,B),s.drawImage(f,O+D,U+N-X,Y-D-z,X,W+I,F+S-B,M,B),s.drawImage(f,O+Y-z,U+N-X,z,X,W+b-k,F+S-B,k,B),s.restore()}destroy(){this._renderer=null}}H.extension={type:[o.CanvasPipes],name:"nineSliceSprite"};const E=class t extends M{constructor(i={}){super({width:(i={...t.defaultOptions,...i}).width,height:i.height,verticesX:4,verticesY:4}),this.update(i)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:i,height:e,_leftWidth:s,_rightWidth:h,_topHeight:n,_bottomHeight:a,_anchorX:o,_anchorY:r}=this,d=s+h,l=i>d?1:i/d,c=n+a,p=e>c?1:e/c,u=Math.min(l,p),_=o*i,g=r*e;t[0]=t[8]=t[16]=t[24]=-_,t[2]=t[10]=t[18]=t[26]=s*u-_,t[4]=t[12]=t[20]=t[28]=i-h*u-_,t[6]=t[14]=t[22]=t[30]=i-_,t[1]=t[3]=t[5]=t[7]=-g,t[9]=t[11]=t[13]=t[15]=n*u-g,t[17]=t[19]=t[21]=t[23]=e-a*u-g,t[25]=t[27]=t[29]=t[31]=e-g,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const i=1/this._originalWidth,e=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=i*this._leftWidth,t[9]=t[11]=t[13]=t[15]=e*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-i*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-e*this._bottomHeight,this.getBuffer("aUV").update()}};E.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let R=E;class O extends A{constructor(){super(),this.geometry=new R}destroy(){this.geometry.destroy()}}class U{constructor(t){this._renderer=t,this._managedSprites=new r({renderer:t,type:"renderable",name:"nineSliceSprite"})}addRenderable(t,i){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),this._renderer.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,i),i._batcher.updateElement(i)}validateRenderable(t){const i=this._getGpuSprite(t);return!i._batcher.checkAndUpdateTexture(i,t._texture)}_updateBatchableSprite(t,i){i.geometry.update(t),i.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const i=t._gpuData[this._renderer.uid]=new O,e=i;return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._managedSprites.add(t),t.didViewUpdate||this._updateBatchableSprite(t,e),i}destroy(){this._managedSprites.destroy(),this._renderer=null}}U.extension={type:[o.WebGLPipes,o.WebGPUPipes],name:"nineSliceSprite"},d.add(H),d.add(U);const W=class t extends l{constructor(i){i instanceof p&&(i={texture:i});const{width:e,height:s,anchor:h,leftWidth:n,rightWidth:a,topHeight:o,bottomHeight:r,texture:d,roundPixels:l,...u}=i;super({label:"NineSliceSprite",...u}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=n??d?.defaultBorders?.left??R.defaultOptions.leftWidth,this._topHeight=o??d?.defaultBorders?.top??R.defaultOptions.topHeight,this._rightWidth=a??d?.defaultBorders?.right??R.defaultOptions.rightWidth,this._bottomHeight=r??d?.defaultBorders?.bottom??R.defaultOptions.bottomHeight,this._width=e??d.width??R.defaultOptions.width,this._height=s??d.height??R.defaultOptions.height,this.allowChildren=!1,this.texture=d??t.defaultOptions.texture,this.roundPixels=l??!1,this._anchor=new c({_onUpdate:()=>{this.onViewUpdate()}}),h?this.anchor=h:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return this._width}set width(t){this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this._height=t,this.onViewUpdate()}setSize(t,i){"object"==typeof t&&(i=t.height??t.width,t=t.width),this._width=t,this._height=i??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=p.EMPTY);const i=this._texture;i!==t&&(i&&i.dynamic&&i.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(t){super.destroy(t);if("boolean"==typeof t?t:t?.texture){const i="boolean"==typeof t?t:t?.textureSource;this._texture.destroy(i)}this._texture=null}updateBounds(){const t=this._bounds,i=this._anchor,e=this._width,s=this._height;t.minX=-i._x*e,t.maxX=t.minX+e,t.minY=-i._y*s,t.maxY=t.minY+s}};W.defaultOptions={texture:p.EMPTY};let F,D=W;function j(t){return"string"==typeof t?u.from(t):t instanceof p?new u(t):t}F="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};class z{constructor(){z.prototype.__init.call(this),z.prototype.__init2.call(this),z.prototype.__init3.call(this),z.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return z._shared||(z._shared=new z),z._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=F}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,i=!1){if(null==t&&(null==this._lastUpdateTime?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const e=Object.keys(this._tweens);if(0==e.length)return!1;for(let s=0;s<e.length;s++){const h=this._tweens[e[s]];h&&0==h.update(t,!0)&&!i&&delete this._tweens[e[s]]}return!0}}const X={Linear:{None:t=>t}},Y={Geom:{Linear(t,i){const e=t.length-1,s=e*i,h=Math.floor(s),n=Y.Utils.Linear;return i<0?n(t[0],t[1],s):i>1?n(t[e],t[e-1],e-s):n(t[h],t[h+1>e?e:h+1],s-h)}},Utils:{Linear:(t,i,e)=>(i-t)*e+t}};class N{static __initStatic(){this._nextId=0}static nextId(){return N._nextId++}}N.__initStatic();const G={safetyCheckFunction:t=>!0,easingFunction:X.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:Y.Geom.Linear};class L{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!=0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=G.safetyCheckFunction}__init15(){this._easingFunction=G.easingFunction}__init16(){this._yoyoEasingFunction=G.yoyoEasingFunction}__init17(){this._interpolationFunction=G.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=N.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:z.shared}set _group(t){this._groupRef=t}constructor(t,i){L.prototype.__init.call(this),L.prototype.__init2.call(this),L.prototype.__init3.call(this),L.prototype.__init4.call(this),L.prototype.__init5.call(this),L.prototype.__init6.call(this),L.prototype.__init7.call(this),L.prototype.__init8.call(this),L.prototype.__init9.call(this),L.prototype.__init10.call(this),L.prototype.__init11.call(this),L.prototype.__init12.call(this),L.prototype.__init13.call(this),L.prototype.__init14.call(this),L.prototype.__init15.call(this),L.prototype.__init16.call(this),L.prototype.__init17.call(this),L.prototype.__init18.call(this),L.prototype.__init19.call(this),L.prototype.__init20.call(this),L.prototype.__init21.call(this),L.prototype.__init22.call(this),this._object=t,this._group=i}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch(i){throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,i){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch(e){return this.dynamicTo(t,i)}return void 0!==i&&(this._duration=i),this}dynamicTo(t,i){return this._valuesEnd=t,void 0!==i&&(this._duration=i),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying||(null!=t&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1)),this}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);const t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,i,e,s,h){for(const n in e){const a=t[n],o=Array.isArray(a),r=!Number.isNaN(Number(a)),d=o?"array":typeof a,l="object"==d,c="object"==typeof e[n],p=!o&&Array.isArray(e[n]);"undefined"!=d&&"function"!=d&&null!=e[n]&&(o||r||l)&&((l||o||c)&&a&&!p?(void 0===i[n]&&(i[n]=o?[]:{}),void 0===s[n]&&(s[n]=o?[]:{}),this._setupProperties(a,i[n],e[n],s[n],h)):((void 0===i[n]||h)&&(i[n]=a),(void 0===s[n]||h)&&(s[n]=p?e[n].slice().reverse()[0]:i[n]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let i=[];if(t||(i=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=i;for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].start()}return this}skip(t,i=!1){return this.resume(),this.update(t*this._duration-(i?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this}resume(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this}stopChainedTweens(){for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let i=0,e=this._chainedTweens.length;i<e;i++)this._chainedTweens[i].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,i=!1){const e=this._internalUpdate(t);return e||i||this._group.remove(this),e}_internalUpdate(t){if(!this._safetyCheckFunction(this._object))return!1;if(this._isPaused)return!1;let i;t*=this._timescale,this._elapsedTime+=t;const e=this._duration,s=this._startTime+this._elapsedTime;if(s>e&&!this._isPlaying)return!1;this.isPlaying||this.start(),0==this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),0==this._onAfterDelayCallbackFired&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),i=s/this._duration,0==this._duration&&(i=s>=0?1:0),i=Math.min(1,i),i=Math.max(0,i);let h=Number.isFinite(s)?s%this._duration:s;Number.isNaN(h)&&(h=0);const n=Math.floor(s/this._duration);let a;if(a=this._reversed&&this._yoyoEasingFunction?this._yoyoEasingFunction(i):this._easingFunction(i),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&(1!=i||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,i,this),1==i){if(this._repeat-this._repeatCount>0){const t=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+n),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||h<=0)&&this._onUpdateCallback(this._object,i,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),void 0!==this._repeatDelayTime?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let i=1;Number.isFinite(n)?i=this._repeatCount-t:Number.isFinite(this._repeat)&&(i=this._repeat-t);for(let e=0;e<i;e++)this._onRepeatCallback(this._object,t+1+e,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return h>0&&Number.isFinite(this._repeat)&&this._internalUpdate(h),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].start(),h>0&&this._chainedTweens[t].update(h);return this._isPlaying=!1,!1}return!0}_updateProperties(t,i,e,s){for(const h in e){if(null==i[h])continue;const n=i[h];let a=e[h];const o=Array.isArray(t[h]),r=Array.isArray(a);!o&&r?this._reversed?t[h]=this._interpolationFunction(a.concat([n]),s):t[h]=this._interpolationFunction([n].concat(a),s):"object"==typeof a&&a?this._updateProperties(t[h],n,a,s):(a=this._handleRelativeValue(n,a),"number"!=typeof a||"number"!=typeof n&&"string"!=typeof n||(t[h]=Number(n)+(a-Number(n))*s,"string"==typeof n&&(t[h]=String(t[h]))))}}_handleRelativeValue(t,i){return"string"!=typeof i?i:"+"==i.charAt(0)||"-"==i.charAt(0)?t+Number(i):Number(i)}_swapEndStartRepeatValues(t,i){for(const e in t){const s=!Array.isArray(t[e])&&Array.isArray(i[e]);if("object"==typeof t[e])this._swapEndStartRepeatValues(t[e],i[e]);else{const h=t[e];if("string"==typeof i[e])t[e]=Number(t[e])+Number(i[e]),i[e]=h;else if(s){const s=i[e].slice().reverse();t[e]=s[0],i[e]=s}else t[e]=i[e],i[e]=h}}}_moveForwardStartRepeatValues(t,i){for(const e in t)"object"==typeof i[e]?this._moveForwardStartRepeatValues(t[e],i[e]):"string"==typeof i[e]&&(t[e]=Number(t[e])+Number(i[e]))}}function J(t,i,e=0,s=!0){let h=i.scale.x,n=i.scale.y;if(!t)throw new Error("Parent is not defined");const a=t.width-2*e,o=t.height-2*e,r=a-Math.round(i.width),d=o-Math.round(i.height);if(r<0&&(h=a/(i.width/h)),d<0&&(n=o/(i.height/n)),h<=0||n<=0)i.scale.set(0);else if(s||i.scale.x===i.scale.y){const t=Math.min(h,n);i.scale.set(t,t)}else{const t=i.scale.x/i.scale.y;r<d?i.scale.set(h,h/t):i.scale.set(n*t,n)}}var $=Object.defineProperty,Q=(t,i,e)=>((t,i,e)=>i in t?$(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class Z extends g{constructor(t){super(),Q(this,"animations"),Q(this,"originalInnerViewState"),Q(this,"defaultDuration",100),Q(this,"options"),Q(this,"_padding",0),Q(this,"_offset",{}),Q(this,"_textOffset",{}),Q(this,"iconOffset",{}),Q(this,"innerView",new w),Q(this,"_views",{}),Q(this,"state","default"),Q(this,"anchor"),Q(this,"_defaultTextScale",{x:1,y:1}),Q(this,"_defaultIconScale",{x:1,y:1}),Q(this,"_defaultTextAnchor",{x:.5,y:.5}),Q(this,"_defaultIconAnchor",{x:.5,y:.5}),this.options=t??{};const{defaultView:i,hoverView:e,pressedView:s,disabledView:h,text:n,padding:a,offset:o,textOffset:r,iconOffset:d,defaultTextScale:l,defaultIconScale:p,defaultTextAnchor:u,defaultIconAnchor:_,scale:g,anchor:m,anchorX:x,anchorY:v,icon:y,animations:b}=t??{};this.addChild(this.innerView),this.anchor=new c({_onUpdate:()=>this.updateAnchor()}),this.anchor.set(x??m??0,v??m??0),this.padding=a??0,this.offset=o??{},this.textOffset=r??{},this.iconOffset=d??{},this.defaultTextScale=l??{x:1,y:1},this.defaultIconScale=p??{x:1,y:1},this.defaultTextAnchor=u??{x:.5,y:.5},this.defaultIconAnchor=_??{x:.5,y:.5},this.scale.set(g??1),b&&(this.animations=b,this.setOriginalInnerViewState(),f.shared.add(()=>z.shared.update())),this.setState("default"),this.defaultView=i,this.hoverView=e,this.pressedView=s,this.disabledView=h,this.text=n??"",void 0!==y&&(this.iconView=y),this.initStateControl()}set text(t){t&&0!==t?this._views.textView?this._views.textView.text=t.toString():this.createTextView(t):this.removeView("textView")}get text(){return this._views.textView?.text}set enabled(t){this.button.enabled=t,this.setState(t?"default":"disabled")}get enabled(){return this.button.enabled}setState(t,i=!1){if(!i&&this.state===t)return;const e=this.getStateView(this.state);e&&(e.visible=!1),this.state=t;const s=this.getStateView(t);s&&(this.setOffset(s,t,this.offset),s.visible=!0),this.updateAnchor(),this.playAnimations(t)}createTextView(t){if(this._views.textView=function(t){return"string"==typeof t||"number"==typeof t?new _({text:String(t)}):t}(t),void 0===this.options?.defaultTextScale){const{x:t,y:i}=this._views.textView.scale;this._defaultTextScale={x:t,y:i}}this.innerView.addChild(this._views.textView),this.adjustTextView(this.state)}setOffset(t,i,e){const s=e?e[i]:{x:0,y:0},h=e?.default;s?(t.x+=s.x??0,t.y+=s.y??0):h?(t.x+=h.x??0,t.y+=h.y??0):(e.x||e.y)&&(t.x+=e.x??0,t.y+=e.y??0)}getStateView(t){if(this._views)switch(t){case"hover":return this._views.hoverView??this._views.defaultView??void 0;case"pressed":return this._views.pressedView??this._views.hoverView??this._views.defaultView??void 0;case"disabled":return this._views.disabledView??this._views.defaultView??void 0;case"default":return this._views.defaultView??void 0;default:return}}adjustTextView(t){if(!this.text)return;if(!this._views.textView)return;const i=this.getStateView(this.state),e=this._defaultTextAnchor.x??.5,s=this._defaultTextAnchor.y??.5;if(i){if(this.options?.ignoreRefitting||this._views.textView.scale.set(this._defaultTextScale.x,this._defaultTextScale.y),"default"===this.contentFittingMode&&J(i,this._views.textView,this.padding,!1),"fill"===this.contentFittingMode){this._views.textView.scale.set(1);const t=i.width-2*this.padding,e=i.height-2*this.padding,s=t/this._views.textView.width,h=e/this._views.textView.height,n=Math.min(s,h);this._views.textView.scale.set(n*(this._defaultTextScale.x??1),n*(this._defaultTextScale.y??1))}this._views.textView.x=i.x+i.width/2,this._views.textView.y=i.y+i.height/2}this._views.textView.anchor.set(e,s),this.setOffset(this._views.textView,t,this.textOffset)}adjustIconView(t){if(!this._views.iconView)return;const i=this.getStateView(t);if(!i)return;if(this.options?.ignoreRefitting||this._views.iconView.scale.set(this._defaultIconScale.x,this._defaultIconScale.y),"default"===this.contentFittingMode&&J(i,this._views.iconView,this.padding,!1),"fill"===this.contentFittingMode){this._views.iconView.scale.set(1);const t=i.width-2*this.padding,e=i.height-2*this.padding,s=t/this._views.iconView.width,h=e/this._views.iconView.height,n=Math.min(s,h);this._views.iconView.scale.set(n*(this._defaultIconScale.x??1),n*(this._defaultIconScale.y??1))}const e=this._defaultIconAnchor.x??.5,s=this._defaultIconAnchor.y??.5;"anchor"in this._views.iconView?this._views.iconView.anchor.set(e,s):this._views.iconView.pivot.set(e*(this._views.iconView.width/this._views.iconView.scale.x),s*(this._views.iconView.height/this._views.iconView.scale.y)),this._views.iconView.x=i.x+i.width/2,this._views.iconView.y=i.y+i.height/2,this.setOffset(this._views.iconView,t,this.iconOffset)}updateAnchor(){if(!this._views)return;const t=this.anchor.x??0,i=this.anchor.y??0;if([this._views.defaultView,this._views.hoverView,this._views.pressedView,this._views.disabledView].forEach(e=>{e&&(e.anchor?.set(0),e.x=-e.width*t,e.y=-e.height*i)}),this._views.defaultView){const{x:t,y:i,width:e,height:s}=this._views.defaultView;this.hitArea=new m(t,i,e,s)}this.adjustIconView(this.state),this.adjustTextView(this.state)}set contentFittingMode(t){this.options.contentFittingMode=t}get contentFittingMode(){return this.options.contentFittingMode??"default"}set defaultView(t){this.updateView("defaultView",t),this._views.disabledView&&"default"!==this.state&&(this._views.disabledView.visible=!1)}get defaultView(){return this._views.defaultView}set hoverView(t){this.updateView("hoverView",t),this._views.hoverView&&"hover"!==this.state&&(this._views.hoverView.visible=!1)}get hoverView(){return this._views.hoverView}set pressedView(t){this.updateView("pressedView",t),this._views.pressedView&&"pressed"!==this.state&&(this._views.pressedView.visible=!1)}get pressedView(){return this._views.pressedView}set disabledView(t){this.updateView("disabledView",t),this._views.disabledView&&"disabled"!==this.state&&(this._views.disabledView.visible=!1)}get disabledView(){return this._views.disabledView}updateView(t,i){void 0!==i&&(this.removeView(t),this.options?.nineSliceSprite&&("string"==typeof i?this._views[t]=new D({texture:p.from(i),leftWidth:this.options.nineSliceSprite[0],topHeight:this.options.nineSliceSprite[1],rightWidth:this.options.nineSliceSprite[2],bottomHeight:this.options.nineSliceSprite[3]}):i instanceof p&&(this._views[t]=new D({texture:i,leftWidth:this.options.nineSliceSprite[0],topHeight:this.options.nineSliceSprite[1],rightWidth:this.options.nineSliceSprite[2],bottomHeight:this.options.nineSliceSprite[3]}))),this._views[t]||(this._views[t]=j(i)),this.setOffset(this._views[t],this.state,this.offset),this._views[t].parent||this.innerView.addChild(this._views[t]),this.updateAnchor(),this._views.iconView&&this.innerView.addChild(this._views.iconView),this._views.textView&&this.innerView.addChild(this._views.textView),this.setState(this.state,!0))}removeView(t){this._views[t]&&(this.innerView.removeChild(this._views[t]),this._views[t]=void 0)}set textView(t){void 0!==t&&(this.removeView("textView"),null!==t&&this.createTextView(t))}get textView(){return this._views.textView}set iconView(t){if(void 0!==t&&(this.removeView("iconView"),null!==t)){if(this._views.iconView=j(t),void 0===this.options?.defaultIconScale){const{x:t,y:i}=this._views.iconView.scale;this._defaultIconScale={x:t,y:i}}this._views.iconView.parent||this.innerView.addChild(this._views.iconView),this.setState(this.state,!0)}}get iconView(){return this._views.iconView}playAnimations(t){if(!this.animations)return;const i=this.animations[t]??this.animations.default;if(i){const t=i;return this.defaultDuration=t.duration??this.defaultDuration,void new L(this.innerView).to(t.props,t.duration).start()}new L(this.innerView).to(this.originalInnerViewState,this.defaultDuration).start()}setOriginalInnerViewState(){this.originalInnerViewState={x:this.innerView.x,y:this.innerView.y,width:this.innerView.width,height:this.innerView.height,scale:{x:this.innerView.scale.x,y:this.innerView.scale.y}};const t=this.animations?.default;t&&(this.innerView.x=t.props.x??this.originalInnerViewState.x??0,this.innerView.y=t.props.y??this.originalInnerViewState.y??0,this.innerView.width=t.props.width??this.originalInnerViewState.width??0,this.innerView.height=t.props.height??this.originalInnerViewState.height??0,this.innerView.scale.x=t.props.scale?.x??this.originalInnerViewState.scale?.x??1,this.innerView.scale.y=t.props.scale?.y??this.originalInnerViewState.scale?.y??1)}initStateControl(){this.onDown.connect(()=>{this.setState("pressed")}),this.onUp.connect(()=>{this.setState(x.any?"default":"hover")}),this.onUpOut.connect(()=>{this.setState("default")}),this.onOut.connect(()=>{this.button.isDown||this.setState("default")}),this.onPress.connect(()=>{this.setState(x.any?"default":"hover")}),this.onHover.connect(()=>{this.button.isDown||this.setState(x.any?"default":"hover")})}set padding(t){this._padding=t,this.adjustTextView(this.state),this.adjustIconView(this.state)}get padding(){return this._padding}set offset(t){this._offset=t,this.updateAnchor()}get offset(){return this._offset}set textOffset(t){this._textOffset=t,this.adjustTextView(this.state)}get textOffset(){return this._textOffset}set defaultTextScale(t){if(void 0===t)return;this.options.defaultTextScale=t;const i="number"==typeof t;this._defaultTextScale.x=i?t:t.x??1,this._defaultTextScale.y=i?t:t.y??1,this.adjustTextView(this.state)}get defaultTextScale(){return this.defaultTextScale}set defaultIconScale(t){if(void 0===t)return;this.options.defaultIconScale=t;const i="number"==typeof t;this._defaultIconScale.x=i?t:t.x??1,this._defaultIconScale.y=i?t:t.y??1,this.adjustIconView(this.state)}get defaultIconScale(){return this.defaultIconScale}set defaultTextAnchor(t){if(void 0===t)return;this.options.defaultTextAnchor=t;const i="number"==typeof t;this._defaultTextAnchor.x=i?t:t.x??1,this._defaultTextAnchor.y=i?t:t.y??1,this.adjustTextView(this.state)}get defaultTextAnchor(){return this.defaultTextAnchor}set defaultIconAnchor(t){if(void 0===t)return;this.options.defaultIconAnchor=t;const i="number"==typeof t;this._defaultIconAnchor.x=i?t:t.x??1,this._defaultIconAnchor.y=i?t:t.y??1,this.adjustIconView(this.state)}get defaultIconAnchor(){return this.defaultIconAnchor}set width(t){this.options?.nineSliceSprite?(this._views.defaultView&&(this._views.defaultView.width=t),this._views.hoverView&&(this._views.hoverView.width=t),this._views.pressedView&&(this._views.pressedView.width=t),this._views.disabledView&&(this._views.disabledView.width=t),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.width=t}get width(){return super.width}set height(t){this.options?.nineSliceSprite?(this._views.defaultView&&(this._views.defaultView.height=t),this._views.hoverView&&(this._views.hoverView.height=t),this._views.pressedView&&(this._views.pressedView.height=t),this._views.disabledView&&(this._views.disabledView.height=t),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.height=t}get height(){return super.height}setSize(t,i){this.options?.nineSliceSprite?(this._views.defaultView&&this._views.defaultView.setSize(t,i),this._views.hoverView&&this._views.hoverView.setSize(t,i),this._views.pressedView&&this._views.pressedView.setSize(t,i),this._views.disabledView&&this._views.disabledView.setSize(t,i),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.setSize(t,i)}}var q=Object.defineProperty,K=(t,i,e)=>((t,i,e)=>i in t?q(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class tt extends w{constructor(t){super(),K(this,"options"),K(this,"_type","bidirectional"),K(this,"_maxWidth",0),K(this,"children",[]),t&&(t.maxWidth&&(this._maxWidth=t.maxWidth),this.init(t)),t?.items?.forEach(t=>this.addChild(t)),this.on("added",()=>this.arrangeChildren()),this.on("childAdded",()=>this.arrangeChildren())}init(t){this.options=t,t?.type&&(this.type=t.type),t?.children&&t.children.forEach(t=>this.addChild(t))}set type(t){this._type=t,this.arrangeChildren()}get type(){return this._type}set elementsMargin(t){if(!this.options)throw new Error("List has not been initiated!");this.options.elementsMargin=t,this.arrangeChildren()}get elementsMargin(){return this.options?.elementsMargin??0}set padding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.padding=t,this.options.vertPadding=t,this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get padding(){return this.options?.padding??0}set vertPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.vertPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get vertPadding(){return this.options?.vertPadding??this.padding??0}set horPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.arrangeChildren()}get horPadding(){return this.options?.horPadding??this.padding??0}set leftPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.leftPadding=t,this.arrangeChildren()}get leftPadding(){return this.options?.leftPadding??this.horPadding}set rightPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.rightPadding=t,this.arrangeChildren()}get rightPadding(){return this.options?.rightPadding??this.horPadding}set topPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.topPadding=t,this.arrangeChildren()}get topPadding(){return this.options?.topPadding??this.vertPadding}set bottomPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.bottomPadding=t,this.arrangeChildren()}get bottomPadding(){return this.options?.bottomPadding??this.vertPadding}arrangeChildren(){let t=0,i=this.leftPadding,e=this.topPadding;const s=this.options?.elementsMargin??0;let h=this.maxWidth||this.parent?.width;this.rightPadding&&(h-=this.rightPadding),this.children.forEach((n,a)=>{switch(this.type){case"vertical":n.y=e,n.x=i,e+=s+n.height;break;case"horizontal":n.x=i,n.y=e,i+=s+n.width;break;default:n.x=i,n.y=e,n.x+n.width>h&&a>0&&(e+=s+t,i=this.leftPadding,n.x=i,n.y=e,t=0),t=Math.max(t,n.height),i+=s+n.width}})}removeItem(t){const i=this.children[t];i&&(this.removeChild(i),this.arrangeChildren())}set maxWidth(t){this._maxWidth=t,this.arrangeChildren()}get maxWidth(){return this._maxWidth}}var it=Object.defineProperty,et=(t,i,e)=>((t,i,e)=>i in t?it(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class st{constructor(t={}){et(this,"x"),et(this,"ax"),et(this,"dx"),et(this,"tx"),et(this,"_options"),this.x=0,this.ax=0,this.dx=0,this.tx=0,this._options={max:t.max??160,damp:t.damp??.8,springiness:t.springiness??.1}}update(){this.ax=(this.tx-this.x)*this._options.springiness,this.dx+=this.ax,this.dx*=this._options.damp,this.dx<-this._options.max?this.dx=-this._options.max:this.dx>this._options.max&&(this.dx=this._options.max),this.x+=this.dx}reset(){this.x=0,this.ax=0,this.dx=0,this.tx=0}get max(){return this._options.max}set max(t){this._options.max=t}get damp(){return this._options.damp}set damp(t){this._options.damp=t}get springiness(){return this._options.springiness}set springiness(t){this._options.springiness=t}}var ht=Object.defineProperty,nt=(t,i,e)=>((t,i,e)=>i in t?ht(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class at{constructor(){nt(this,"done",!1),nt(this,"to",0),nt(this,"_spring"),nt(this,"_pos",0),nt(this,"_speed",0),nt(this,"_correctSpeed",!1),this._spring=new st,this._pos=0,this.to=0}start(t,i,e){this._speed=t,this._pos=i,this.to=e,this.done=!1,this._spring.x=this._pos,this._spring.tx=this.to;const s=this.to-this._pos,h=Math.abs(s)/s,n=Math.abs(this._speed)/this._speed;this._correctSpeed=h!==n}update(){if(this._correctSpeed)this._speed*=.6,Math.abs(this._speed)<2&&(this._correctSpeed=!1),this._pos+=this._speed,this._spring.x=this._pos;else{const t=this.to-this._pos;Math.abs(t)<.05?(this._pos=this.to,this.done=!0):(this._spring.tx=this.to,this._spring.update(),this._pos=this._spring.x)}return this._pos}cancel(){}}var ot=Object.defineProperty,rt=(t,i,e)=>((t,i,e)=>i in t?ot(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class dt{constructor(t={}){rt(this,"position",0),rt(this,"constrain",!0),rt(this,"min",0),rt(this,"max",0),rt(this,"maxSpeed",400),rt(this,"_ease"),rt(this,"_offset",0),rt(this,"_prev",0),rt(this,"_speed",0),rt(this,"_hasStopped",!1),rt(this,"_targetSpeed",0),rt(this,"_speedChecker",0),rt(this,"_grab",0),rt(this,"_activeEase"),this.constrain=t.constrain??!0,this.maxSpeed=t.maxSpeed??400,this._ease=t.ease??new at}set value(t){this._speed=0,this.position=t}get value(){return this.position}grab(t){this._grab=t,this._offset=this.position-t,this._speedChecker=0,this._targetSpeed=this._speed=0,this._hasStopped=!1}hold(t){this._speedChecker++,this.position=t+this._offset,this._speedChecker>1&&(this._targetSpeed=this.position-this._prev),this._speed+=(this._targetSpeed-this._speed)/2,this._speed>this.maxSpeed?this._speed=this.maxSpeed:this._speed<-this.maxSpeed&&(this._speed=-this.maxSpeed),this._prev=this.position,this.constrain&&(this._activeEase=void 0,this.position>this.min?this.position-=(this.position-this.min)/1.5:this.position<this.max&&(this.position+=(this.max-this.position)/1.5))}slide(t=!1){this._hasStopped||(this.constrain?this._updateConstrain(t):this._updateDefault())}get moveAmount(){return-(this.position-this._offset-this._grab)}_updateDefault(){this._speed*=.9,this.position+=this._speed,(this._speed<0?-1*this._speed:this._speed)<.01&&(this._hasStopped=!0)}_updateConstrain(t=!1){const i=this.max;t?(this.value>0&&(this.value=0),this.value>0&&(this.value=0),this.value<this.max&&(this.value=this.max),this.value<this.max&&(this.value=this.max)):this.position>this.min||this.position<i||this._activeEase?(this._activeEase||(this._activeEase=this._ease,this.position>this.min?this._activeEase.start(this._speed,this.position,this.min):this._activeEase.start(this._speed,this.position,i)),this.position=this._activeEase.update(),this._activeEase.done&&(this.position=this._activeEase.to,this._speed=0,this._activeEase=void 0)):this._updateDefault()}}var lt=Object.defineProperty,ct=(t,i,e)=>((t,i,e)=>i in t?lt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class pt{constructor(t){ct(this,"xAxis"),ct(this,"yAxis"),ct(this,"_isDown",!1),ct(this,"_globalPosition"),ct(this,"_frame"),ct(this,"_bounds"),ct(this,"_dirty",!1),ct(this,"disableEasing",!1),this.xAxis=new dt({ease:t.xEase,maxSpeed:t.maxSpeed,constrain:t.constrain}),this.yAxis=new dt({ease:t.yEase,maxSpeed:t.maxSpeed,constrain:t.constrain}),this.disableEasing=t.disableEasing??!1,this._frame=new m,this._bounds=new m,this._globalPosition=new v}pointerDown(t){this._globalPosition=t,this.xAxis.grab(t.x),this.yAxis.grab(t.y),this._isDown=!0}pointerUp(){this._isDown=!1}pointerMove(t){this._globalPosition=t}update(){this._dirty&&this._bounds&&this._frame&&(this._dirty=!1,this.xAxis.min=this._bounds.left,this.xAxis.min=this._bounds.right-this._frame.width,this.xAxis.min=this._bounds.top,this.xAxis.min=this._bounds.bottom-this._frame.height),this._isDown&&this._globalPosition?(this.xAxis.hold(this._globalPosition.x),this.yAxis.hold(this._globalPosition.y)):(this.xAxis.slide(this.disableEasing),this.yAxis.slide(this.disableEasing))}resize(t,i){this._frame&&(this._frame.x=0,this._frame.width=t,this._frame.y=0,this._frame.height=i,this._dirty=!0)}setBounds(t,i,e,s){this._bounds&&(this._bounds.x=t,this._bounds.width=i-t,this._bounds.y=e,this._bounds.height=s-e,this._dirty=!0)}get x(){return this.xAxis.value}get y(){return this.yAxis.value}}var ut=Object.defineProperty,_t=(t,i,e)=>((t,i,e)=>i in t?ut(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class gt extends w{constructor(t){super(),_t(this,"background"),_t(this,"borderMask"),_t(this,"lastWidth",0),_t(this,"lastHeight",0),_t(this,"_width",0),_t(this,"_height",0),_t(this,"_dimensionChanged",!1),_t(this,"list"),_t(this,"_trackpad"),_t(this,"isDragging",0),_t(this,"interactiveStorage",[]),_t(this,"visibleItems",[]),_t(this,"pressedChild"),_t(this,"ticker",f.shared),_t(this,"options",{}),_t(this,"stopRenderHiddenItemsTimeout"),_t(this,"onMouseScrollBinding",this.onMouseScroll.bind(this)),_t(this,"dragStarTouchPoint"),_t(this,"isOver",!1),_t(this,"proximityRange",0),_t(this,"proximityStatusCache",[]),_t(this,"lastScrollX"),_t(this,"lastScrollY"),_t(this,"proximityCheckFrameCounter",0),_t(this,"onProximityChange",new y.Signal),_t(this,"onScroll",new y.Signal),t&&this.init(t),this.ticker.add(this.update,this)}init(t){this.options=t,this.setBackground(t.background),this._width=t.width??this.background?.width??100,this._height=t.height??this.background?.height??100,this.proximityRange=t.proximityRange??0,this.list||(this.list=new tt,super.addChild(this.list)),this.list?.init({type:t.type,elementsMargin:t.elementsMargin,padding:t.padding,vertPadding:t.vertPadding,horPadding:t.horPadding,topPadding:t.topPadding,bottomPadding:t.bottomPadding,leftPadding:t.leftPadding,rightPadding:t.rightPadding,maxWidth:t.maxWidth||("horizontal"!==t.type&&"vertical"!==t.type?this._width:0)}),t.items&&this.addItems(t.items),this.hasBounds&&(this.addMask(),this.makeScrollable()),this._trackpad&&(this._trackpad.xAxis.value=0,this._trackpad.yAxis.value=0),this.options.globalScroll=t.globalScroll??!0,this.options.shiftScroll=t.shiftScroll??!1,this.resize()}get hasBounds(){return!!this._width||!!this._height}addItems(t){t?.length&&t.forEach(t=>this.addItem(t))}removeItems(){this.proximityStatusCache.length=0,this.list?.removeChildren()}addItem(...t){if(t.length>1)t.forEach(t=>this.addItem(t));else{const i=t[0];!i.width||i.height,i.eventMode="static",this.list?.addChild(i),this.proximityStatusCache.push(!1),this.options.disableDynamicRendering||(i.renderable=this.isItemVisible(i))}return this.resize(),t[0]}removeItem(t){this.list?.removeItem(t),this.proximityStatusCache.splice(t,1),this.resize()}isItemVisible(t,i=0){let e=!1;const s=this.list;if(!s)return!1;if(this.isVertical||this.isBidirectional){const h=t.y+s.y;h+t.height>=-i&&h<=(this.options.height??this._height)+i&&(e=!0)}if(this.isHorizontal||this.isBidirectional){const h=t.x+s.x;h+t.width>=-i&&h<=(this.options.width??this._width)+i&&(e=!0)}return e}get items(){return this.list?.children??[]}setBackground(t){this.background&&this.removeChild(this.background),this.options.background=t,this.background=new b,this.addChildAt(this.background,0),this.resize()}addMask(){this.borderMask||(this.borderMask=new b,super.addChild(this.borderMask),this.mask=this.borderMask),this.resize()}makeScrollable(){this._trackpad||(this._trackpad=new pt({disableEasing:this.options.disableEasing})),this.on("pointerdown",t=>{this.renderAllItems(),this.isDragging=1,this.dragStarTouchPoint=this.worldTransform.applyInverse(t.global),this._trackpad&&this.dragStarTouchPoint&&this._trackpad.pointerDown(new v(this.dragStarTouchPoint.x,this.dragStarTouchPoint.y));const i=this.list?.worldTransform.applyInverse(t.global);i&&this.visibleItems.forEach(t=>{t.x<i.x&&t.x+t.width>i.x&&t.y<i.y&&t.y+t.height>i.y&&(this.pressedChild=t)})}),this.on("pointerup",()=>{this.isDragging=0,this._trackpad?.pointerUp(),this.restoreItemsInteractivity(),this.pressedChild=void 0,this.stopRenderHiddenItems()}),this.on("pointerover",()=>{this.isOver=!0}),this.on("pointerout",()=>{this.isOver=!1}),this.on("pointerupoutside",()=>{this.isDragging=0,this._trackpad?.pointerUp(),this.restoreItemsInteractivity(),this.pressedChild=void 0,this.stopRenderHiddenItems()}),this.on("globalpointermove",t=>{if(!this.isDragging)return;const i=this.worldTransform.applyInverse(t.global);if(this.dragStarTouchPoint){const t=this.options.dragTrashHold??10;if(this.isHorizontal||this.isBidirectional){const e=i.x-this.dragStarTouchPoint.x;Math.abs(e)>t&&(this.isDragging=2)}if(this.isVertical||this.isBidirectional){const e=i.y-this.dragStarTouchPoint.y;Math.abs(e)>t&&(this.isDragging=2)}}this.dragStarTouchPoint&&2!==this.isDragging||(this._trackpad?.pointerMove(new v(i.x,i.y)),this.pressedChild&&(this.revertClick(this.pressedChild),this.pressedChild=void 0),this.isBidirectional?this.onScroll?.emit({x:this.scrollX,y:this.scrollY}):this.onScroll?.emit(this.isVertical?this.scrollY:this.scrollX))}),document.addEventListener("wheel",this.onMouseScrollBinding,!0)}setInteractive(t){this.eventMode=t?"static":"auto"}get listHeight(){return(this.list?.height??0)+(this.list?.topPadding??0)+(this.list?.bottomPadding??0)}get listWidth(){return(this.list?.width??0)+(this.list?.leftPadding??0)+(this.list?.rightPadding??0)}resize(t=!1){if(this.hasBounds){if(this.renderAllItems(),this.borderMask&&(t||this._dimensionChanged||this.lastWidth!==this.listWidth||this.lastHeight!==this.listHeight)){this.options.width||(this._width+=this.listWidth),this.options.height||(this._height+=this.listHeight),this.borderMask?.clear().roundRect(0,0,this._width,this._height,0|(this.options.radius??0)).fill(16711935).stroke(0),this.borderMask&&(this.borderMask.eventMode="none");const t=this.options.background;this.background?.clear().roundRect(0,0,this._width,this._height,0|(this.options.radius??0)).fill({color:t??0,alpha:t?1:1e-7}),this.isBidirectional?this.setInteractive(this.listWidth>this._width||this.listHeight>this._height):this.isHorizontal?this.setInteractive(this.listWidth>this._width):this.setInteractive(this.listHeight>this._height),this.lastWidth=this.listWidth,this.lastHeight=this.listHeight}if(this._trackpad&&this.borderMask){const t=this.borderMask.width-(this.list?.width??0)-(this.list?.leftPadding??0)-(this.list?.rightPadding??0),i=this.borderMask.height-(this.list?.height??0)-(this.list?.topPadding??0)-(this.list?.bottomPadding??0);this.isBidirectional?(this._trackpad.yAxis.max=-Math.abs(i),this._trackpad.xAxis.max=-Math.abs(t)):this.isVertical?this._trackpad.yAxis.max=-Math.abs(i):this.isHorizontal&&(this._trackpad.xAxis.max=-Math.abs(t))}this._dimensionChanged?(this.list?.arrangeChildren(),this.stopRenderHiddenItems(),this._dimensionChanged=!1):(t&&this.list?.arrangeChildren(),this.updateVisibleItems()),this.lastScrollX=void 0,this.lastScrollY=void 0}}onMouseScroll(t){if(!this.isOver&&!this.options.globalScroll)return;this.renderAllItems();const i=!!this.options.shiftScroll,e=i?void 0!==t.deltaX||void 0!==t.deltaY:void 0!==t.deltaX,s=void 0!==t.deltaY;if((this.isHorizontal||this.isBidirectional)&&e){const e=i||this.isBidirectional?t.deltaX:t.deltaY,s=(this.list?.x??0)-e;if(this.listWidth<this._width)this._trackpad&&(this._trackpad.xAxis.value=0);else{const t=this._width-this.listWidth,i=0;this._trackpad&&(this._trackpad.xAxis.value=Math.min(i,Math.max(t,s)))}}if((this.isVertical||this.isBidirectional)&&s){const i=(this.list?.y??0)-t.deltaY;if(this.listHeight<this._height)this._trackpad&&(this._trackpad.yAxis.value=0);else{const t=this._height-this.listHeight,e=0;this._trackpad&&(this._trackpad.yAxis.value=Math.min(e,Math.max(t,i)))}}this.isBidirectional&&(e||s)?this.onScroll?.emit({x:this._trackpad?.xAxis.value??0,y:this._trackpad?.yAxis.value??0}):this.isHorizontal&&e?this.onScroll?.emit(this._trackpad?.xAxis.value??0):this.isVertical&&s&&this.onScroll?.emit(this._trackpad?.yAxis.value??0),this.stopRenderHiddenItems()}scrollBottom(){this.interactive?this.scrollTo((this.list?.children.length??1)-1):this.scrollTop()}scrollTop(){this.renderAllItems(),this._trackpad&&(this._trackpad.xAxis.value=0,this._trackpad.yAxis.value=0),this.stopRenderHiddenItems()}renderAllItems(){clearTimeout(this.stopRenderHiddenItemsTimeout),this.stopRenderHiddenItemsTimeout=void 0,this.options.disableDynamicRendering||this.items.forEach(t=>{t.renderable=!0})}stopRenderHiddenItems(){this.options.disableDynamicRendering||(this.stopRenderHiddenItemsTimeout&&(clearTimeout(this.stopRenderHiddenItemsTimeout),this.stopRenderHiddenItemsTimeout=void 0),this.stopRenderHiddenItemsTimeout=setTimeout(()=>this.updateVisibleItems(),2e3))}updateVisibleItems(){this.visibleItems.length=0,this.items.forEach(t=>{t.renderable=this.isItemVisible(t),this.visibleItems.push(t)})}scrollTo(t){if(!this.interactive||!this._trackpad||!this.list)return;const i=this.list.children[t];i&&(this.renderAllItems(),this._trackpad.xAxis.value=this.isHorizontal||this.isBidirectional?this._width-i.x-i.width-this.list.rightPadding:0,this._trackpad.yAxis.value=this.isVertical||this.isBidirectional?this._height-i.y-i.height-this.list.bottomPadding:0,this.stopRenderHiddenItems())}scrollToPosition({x:t,y:i}){void 0===t&&void 0===i||(this.renderAllItems(),void 0!==t&&(this.scrollX=-t),void 0!==i&&(this.scrollY=-i),this.stopRenderHiddenItems())}get height(){return this._height}set height(t){this._height=t,this._dimensionChanged=!0,this.resize(),this.scrollTop()}get width(){return this._width}set width(t){this._width=t,this._dimensionChanged=!0,this.resize(),this.scrollTop()}setSize(t,i){"object"==typeof t?(i=t.height??t.width,t=t.width):i=i??t,this._width=t,this._height=i,this._dimensionChanged=!0,this.resize(),this.scrollTop()}getSize(t){return(t=t||{width:0,height:0}).width=this._width,t.height=this._height,t}get scrollX(){return this._trackpad?.xAxis.value??0}set scrollX(t){this._trackpad&&(this._trackpad.xAxis.value=t)}get scrollY(){return this._trackpad?.yAxis.value??0}set scrollY(t){this._trackpad&&(this._trackpad.yAxis.value=t)}update(){this.list&&this._trackpad&&(this._trackpad.update(),(this.isHorizontal||this.isBidirectional)&&this.list.x!==this._trackpad.x&&(this.list.x=this._trackpad.x),(this.isVertical||this.isBidirectional)&&this.list.y!==this._trackpad.y&&(this.list.y=this._trackpad.y),this.options.disableProximityCheck||this._trackpad.x===this.lastScrollX&&this._trackpad.y===this.lastScrollY||(this.proximityCheckFrameCounter++,this.proximityCheckFrameCounter>=(this.options.proximityDebounce??10)&&(this.items.forEach((t,i)=>{const e=this.isItemVisible(t,this.proximityRange);e!==this.proximityStatusCache[i]&&(this.proximityStatusCache[i]=e,this.onProximityChange.emit({item:t,index:i,inRange:e}))}),this.lastScrollX=this._trackpad.x,this.lastScrollY=this._trackpad.y,this.proximityCheckFrameCounter=0)))}destroy(t){this.ticker.remove(this.update,this),document.removeEventListener("wheel",this.onMouseScrollBinding,!0),this.background?.destroy(),this.list?.destroy(),super.destroy(t)}restoreItemsInteractivity(){this.interactiveStorage.forEach(t=>{t.item.eventMode=t.eventMode}),this.interactiveStorage.length=0}revertClick(t){"auto"!==t.eventMode&&(x.any?t.emit("pointerupoutside",{target:t}):t.emit("mouseupoutside",{target:t}),this.interactiveStorage.push({item:t,eventMode:t.eventMode??"auto"}),t.eventMode="auto"),t instanceof w&&t.children&&t.children.forEach(t=>this.revertClick(t))}get scrollHeight(){return this.list?.height??0}get scrollWidth(){return this.list?.width??0}get isVertical(){return"vertical"===(this.options.type??"vertical")}get isHorizontal(){return"horizontal"===this.options.type}get isBidirectional(){return"bidirectional"===this.options.type}}var wt=Object.defineProperty,ft=(t,i,e)=>((t,i,e)=>i in t?wt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class mt extends w{constructor(t){super(),ft(this,"view",new w),ft(this,"openButton"),ft(this,"closeButton"),ft(this,"openView"),ft(this,"scrollBox"),ft(this,"value",-1),ft(this,"onSelect"),this.addChild(this.view),this.onSelect=new y.Signal,t&&this.init(t)}init({closedBG:t,textStyle:i,TextClass:e,items:s,openBG:h,selected:n,selectedTextOffset:a,scrollBox:o,visibleItems:r}){e=e??_,this.openView&&this.openView!==h&&this.view.removeChild(this.openView),this.openButton?(this.openButton.defaultView=j(t),this.openButton.textView=new e({text:s?.items?s.items[0]:"",style:i}),this.openButton.textOffset=a??{}):(this.openButton=new Z({defaultView:t,text:new e({text:s?.items?s.items[0]:"",style:i}),textOffset:a}),this.openButton.onPress.connect(()=>this.toggle()),this.addChild(this.openButton)),this.openView!==h&&(this.openView=j(h),this.view.visible=!1,this.view.addChild(this.openView)),this.closeButton?(this.closeButton.defaultView=(new b).rect(0,0,this.openButton.width,this.openButton.height).fill({color:0,alpha:1e-5}),this.closeButton.textView=new e({text:s?.items?s.items[0]:"",style:i}),this.openButton.textOffset=a??{}):(this.closeButton=new Z({defaultView:(new b).rect(0,0,this.openButton.width,this.openButton.height).fill({color:0,alpha:1e-5}),text:new e({text:s?.items?s.items[0]:"",style:i}),textOffset:a}),this.closeButton.onPress.connect(()=>this.toggle()),this.view.addChild(this.closeButton)),this.scrollBox?this.scrollBox.removeItems():(this.scrollBox=new gt,this.view.addChild(this.scrollBox)),this.scrollBox.init({type:"vertical",elementsMargin:0,width:this.openButton.width,height:this.openButton.height*(r??5),radius:0,padding:0,...o}),this.scrollBox.y=this.openButton.height,o?.offset&&(this.scrollBox.x=o.offset.x??0,this.scrollBox.y+=o.offset.y??0),this.addItems(s,n)}addItems(t,i=0){this.convertItemsToButtons(t).forEach((t,e)=>{const s=t.text;e===i&&(this.openButton.text=s??"",this.closeButton.text=s??""),t.onPress.connect(()=>{this.value=e,this.onSelect.emit(e,s??""),this.openButton.text=s??"",this.closeButton.text=s??"",this.close()}),this.scrollBox?.addItem(t)})}removeItem(t){this.scrollBox&&this.scrollBox.removeItem(t)}toggle(){this.view.visible=!this.view.visible,this.openButton.visible=!this.openButton.visible}open(){this.view.visible=!0,this.openButton.visible=!1}close(){this.view.visible=!1,this.openButton.visible=!0}convertItemsToButtons({items:t,backgroundColor:i,hoverColor:e,width:s,height:h,textStyle:n,TextClass:a,radius:o}){a=a??_;const r=[];return t.forEach(t=>{const d=(new b).roundRect(0,0,s,h,o).fill(i),l=e??i,c=(new b).roundRect(0,0,s,h,o).fill(l),p=new a({text:t,style:n}),u=new Z({defaultView:d,hoverView:c,text:p});r.push(u)}),r}}class xt extends w{constructor(t,i,e){super(),this.label="Target Item",this.targetSize=i,this.item=t;this.sprite=new V(t,i,i),this.sprite.x=(e-i)/2,this.addChild(this.sprite);const s=Math.max(14,Math.floor(.18*i)),h={fill:16777215,fontSize:s,wordWrap:!0,wordWrapWidth:e-40,align:"center"};this.nameText=new _(t.name,h),this.nameText.anchor.set(.5,0),this.nameText.position.set(e/2,i+10),this.descText=new _(t.description,{...h,fontSize:.8*s,fill:13421772}),this.descText.anchor.set(.5,0),this.addChild(this.nameText,this.descText),this.updateTextPositions(e)}updateTextPositions(t){const i=t/2;this.nameText.x=i,this.descText.x=i,this.descText.y=this.nameText.y+this.nameText.height+6}update(t,i){this.item=t,this.sprite.updateData&&this.sprite.updateData(t),this.nameText.text=t.name,this.descText.text=t.description,this.updateTextPositions(i)}getGlobalPosition(){return this.sprite.toGlobal({x:0,y:0})}getCenterGlobalPosition(){return this.sprite.toGlobal({x:this.targetSize/2,y:this.targetSize/2})}}class vt extends C{constructor(t){super(t),this.score=0,this.maxTrials=10,this.draggingSprite=null,this.dragOffset={x:0,y:0},this.recipeCounter={ok:0,hitTotal:0,missTotal:0},this.drawUI(),this.drawTarget()}getCountString(){return`Hit: ${this.recipeCounter.hitTotal} Miss: ${this.recipeCounter.missTotal}`}drawUI(){const{width:t,height:i}=this.ctx.app.screen,e=i>t,s=e?10:20,h=this.topHudContainer.height;this.scoreText=new _(this.getCountString(),{fill:16777215,fontSize:e?14:18});const n=(h-this.scoreText.height)/2;this.scoreText.position.set(s,n),this.topHudContainer.addChild(this.scoreText);const a=Object.values(S),o=a.findIndex(t=>t.id===this.ctx.activeSetId),r={fill:0,fontSize:e?14:18},d=e?140:200,l=e?25:40,c=new mt({closedBG:(new b).roundRect(0,0,d,l,10).fill(13421772),openBG:(new b).roundRect(0,0,d,200,10).fill(15658734),textStyle:r,selected:o,items:{items:a.map(t=>t.name),backgroundColor:15658734,hoverColor:14540253,width:d,height:l,textStyle:r},scrollBox:{width:d,height:160}}),p=t-d-s,u=(h-l)/2;c.position.set(p,u),c.onSelect.connect(t=>{const i=a[t];i&&(this.ctx.selectSet(i.id),this.ctx.goToScene(vt))}),this.topHudContainer.addChild(c),this.ctx.app.ticker.add(()=>{c&&c.update&&c.update()})}drawTarget(){const t=this.gameAreaContainer.width,i=this.gameAreaContainer.height;this.targetItem?this.targetItem.update(this.ctx.currentSet.getRandomCombinedItem(),t):(this.targetItem=new xt(this.ctx.currentSet.getRandomCombinedItem(),T,t),this.gameAreaContainer.addChild(this.targetItem)),this.targetItem.scale.set(1);const e=this.targetItem.height;if(e>i-20){const t=(i-20)/e;this.targetItem.scale.set(t)}this.targetItem.x=(t-t*this.targetItem.scale.x)/2,this.targetItem.y=(i-e*this.targetItem.scale.y)/2}findTargetTftItem(t){return this.targetItem}updateCounter(){this.scoreText.text=this.getCountString()}showTemporaryResult(t){const i=new u(p.from(`/items/${t.icon}`));i.width=80,i.height=80,i.position.set(this.ctx.app.screen.width/2-40,this.ctx.app.screen.height/2-40),i.alpha=.9,this.container.addChild(i);const e=new _(t.name,{fill:16777215,fontSize:20});e.anchor.set(.5),e.position.set(this.ctx.app.screen.width/2,this.ctx.app.screen.height/2+50),this.container.addChild(e),setTimeout(()=>{i.destroy(),e.destroy()},1e3)}onHit(t,i){this.recipeCounter.ok=0,this.recipeCounter.hitTotal++,this.updateCounter(),this.dragPanel.disableGlow(),this.drawTarget(),this.dragPanel.drawItems()}onMiss(t){this.recipeCounter.missTotal++,this.recipeCounter.missTotal%3==1&&this.dragPanel.glow(this.targetItem.item.recipe[0]),this.recipeCounter.missTotal%3==2&&this.dragPanel.glow(this.targetItem.item.recipe[1]),this.updateCounter()}destroy(){this.targetItem&&this.ctx.app.stage.off("pointermove",this.onDragMove,this),super.destroy()}}export{vt as default};
