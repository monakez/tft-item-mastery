import{as as t,i,v as e,A as s,F as h,J as n,K as o,E as r,c as a,e as d,V as l,at as c,T as u,t as p,b as _,au as g,Z as w,R as f,P as m}from"./index-eJpqKaHf.js";import{T as v,G as x,a as b}from"./GameScene-csI6bS_x.js";import{i as y}from"./isMobile-BcRc3o16.js";import{c as S}from"./canvasUtils-f2nCwI2T.js";import{G as V}from"./Graphics-B04i3yF2.js";import"./Filter-Cw1r2BT3.js";import"./colorToUniform-DIWNkBfR.js";const C=class n extends t{constructor(...t){let o=t[0]??{};o instanceof Float32Array&&(i(e,"use new MeshGeometry({ positions, uvs, indices }) instead"),o={positions:o,uvs:t[1],indices:t[2]}),o={...n.defaultOptions,...o};const r=o.positions||new Float32Array([0,0,1,0,1,1,0,1]);let a=o.uvs;a||(a=o.positions?new Float32Array(r.length):new Float32Array([0,0,1,0,1,1,0,1]));const d=o.indices||new Uint32Array([0,1,2,0,2,3]),l=o.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new s({data:r,label:"attribute-mesh-positions",shrinkToFit:l,usage:h.VERTEX|h.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new s({data:a,label:"attribute-mesh-uvs",shrinkToFit:l,usage:h.VERTEX|h.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new s({data:d,label:"index-mesh-buffer",shrinkToFit:l,usage:h.INDEX|h.COPY_DST}),topology:o.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};C.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let P=C;class k{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),i=t.data;let e=i;const s=this.texture.textureMatrix;return s.isSimple||(e=this._transformedUvs,this._textureMatrixUpdateId===s._updateID&&this._uvUpdateId===t._updateID||((!e||e.length<i.length)&&(e=this._transformedUvs=new Float32Array(i.length)),this._textureMatrixUpdateId=s._updateID,this._uvUpdateId=t._updateID,s.multiplyUvs(i,e))),e}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}const T=class t extends P{constructor(...t){super({});let s=t[0]??{};"number"==typeof s&&(i(e,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),s={width:s,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(s)}build(i){i={...t.defaultOptions,...i},this.verticesX=this.verticesX??i.verticesX,this.verticesY=this.verticesY??i.verticesY,this.width=this.width??i.width,this.height=this.height??i.height;const e=this.verticesX*this.verticesY,s=[],h=[],n=[],o=this.verticesX-1,r=this.verticesY-1,a=this.width/o,d=this.height/r;for(let t=0;t<e;t++){const i=t%this.verticesX,e=t/this.verticesX|0;s.push(i*a,e*d),h.push(i/o,e/r)}const l=o*r;for(let t=0;t<l;t++){const i=t%o,e=t/o|0,s=e*this.verticesX+i,h=e*this.verticesX+i+1,r=(e+1)*this.verticesX+i,a=(e+1)*this.verticesX+i+1;n.push(s,h,r,h,a,r)}this.buffers[0].data=new Float32Array(s),this.buffers[1].data=new Float32Array(h),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};T.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let I=T;class A{constructor(t){this._renderer=t}validateRenderable(t){return!1}addRenderable(t,i){this._renderer.renderPipes.batch.break(i),i.add(t)}updateRenderable(t){}execute(t){const i=this._renderer,e=i.canvasContext,s=e.activeContext;s.save();const h=t.groupTransform,r=i._roundPixels|t._roundPixels;e.setContextTransform(h,1===r),e.setBlendMode(t.groupBlendMode);const a=i.globalUniforms.globalUniformData?.worldColor??4294967295,d=t.groupColorAlpha,l=(a>>>24&255)/255*((d>>>24&255)/255)*(i.filter?.alphaMultiplier??1);if(l<=0)return void s.restore();s.globalAlpha=l;const c=n(o(16777215&d,16777215&a)),u=t.texture,p=S.getCanvasSource(u);if(!p)return void s.restore();const _=e.smoothProperty,g="nearest"!==u.source.style.scaleMode;s[_]!==g&&(s[_]=g);const w=16777215!==c||0!==u.rotate,f=w?S.getTintedCanvas({texture:u},c):p,{leftWidth:m,topHeight:v,rightWidth:x,bottomHeight:b,width:y,height:V}=t,C=m+x,P=v+b,k=Math.min(C>y?y/C:1,P>V?V/P:1,1),T=m*k,I=x*k,A=v*k,O=b*k,M=Math.max(0,y-T-I),B=Math.max(0,V-A-O),U=t.anchor,E=u.source._resolution??u.source.resolution??1;let D=u.frame.x*E,H=u.frame.y*E;const R=-U.x*y,j=-U.y*V,W=m*E,F=v*E,z=x*E,N=b*E;let L=u.frame.width*E,X=u.frame.height*E;w&&(D=0,H=0,L=f.width,X=f.height),s.drawImage(f,D,H,W,F,R,j,T,A),s.drawImage(f,D+W,H,L-W-z,F,R+T,j,M,A),s.drawImage(f,D+L-z,H,z,F,R+y-I,j,I,A),s.drawImage(f,D,H+F,W,X-F-N,R,j+A,T,B),s.drawImage(f,D+W,H+F,L-W-z,X-F-N,R+T,j+A,M,B),s.drawImage(f,D+L-z,H+F,z,X-F-N,R+y-I,j+A,I,B),s.drawImage(f,D,H+X-N,W,N,R,j+V-O,T,O),s.drawImage(f,D+W,H+X-N,L-W-z,N,R+T,j+V-O,M,O),s.drawImage(f,D+L-z,H+X-N,z,N,R+y-I,j+V-O,I,O),s.restore()}destroy(){this._renderer=null}}A.extension={type:[r.CanvasPipes],name:"nineSliceSprite"};const O=class t extends I{constructor(i={}){super({width:(i={...t.defaultOptions,...i}).width,height:i.height,verticesX:4,verticesY:4}),this.update(i)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:i,height:e,_leftWidth:s,_rightWidth:h,_topHeight:n,_bottomHeight:o,_anchorX:r,_anchorY:a}=this,d=s+h,l=i>d?1:i/d,c=n+o,u=e>c?1:e/c,p=Math.min(l,u),_=r*i,g=a*e;t[0]=t[8]=t[16]=t[24]=-_,t[2]=t[10]=t[18]=t[26]=s*p-_,t[4]=t[12]=t[20]=t[28]=i-h*p-_,t[6]=t[14]=t[22]=t[30]=i-_,t[1]=t[3]=t[5]=t[7]=-g,t[9]=t[11]=t[13]=t[15]=n*p-g,t[17]=t[19]=t[21]=t[23]=e-o*p-g,t[25]=t[27]=t[29]=t[31]=e-g,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const i=1/this._originalWidth,e=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=i*this._leftWidth,t[9]=t[11]=t[13]=t[15]=e*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-i*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-e*this._bottomHeight,this.getBuffer("aUV").update()}};O.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let M=O;class B extends k{constructor(){super(),this.geometry=new M}destroy(){this.geometry.destroy()}}class U{constructor(t){this._renderer=t,this._managedSprites=new a({renderer:t,type:"renderable",name:"nineSliceSprite"})}addRenderable(t,i){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),this._renderer.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,i),i._batcher.updateElement(i)}validateRenderable(t){const i=this._getGpuSprite(t);return!i._batcher.checkAndUpdateTexture(i,t._texture)}_updateBatchableSprite(t,i){i.geometry.update(t),i.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const i=t._gpuData[this._renderer.uid]=new B,e=i;return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._managedSprites.add(t),t.didViewUpdate||this._updateBatchableSprite(t,e),i}destroy(){this._managedSprites.destroy(),this._renderer=null}}U.extension={type:[r.WebGLPipes,r.WebGPUPipes],name:"nineSliceSprite"},d.add(A),d.add(U);const E=class t extends l{constructor(i){i instanceof u&&(i={texture:i});const{width:e,height:s,anchor:h,leftWidth:n,rightWidth:o,topHeight:r,bottomHeight:a,texture:d,roundPixels:l,...p}=i;super({label:"NineSliceSprite",...p}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=n??d?.defaultBorders?.left??M.defaultOptions.leftWidth,this._topHeight=r??d?.defaultBorders?.top??M.defaultOptions.topHeight,this._rightWidth=o??d?.defaultBorders?.right??M.defaultOptions.rightWidth,this._bottomHeight=a??d?.defaultBorders?.bottom??M.defaultOptions.bottomHeight,this._width=e??d.width??M.defaultOptions.width,this._height=s??d.height??M.defaultOptions.height,this.allowChildren=!1,this.texture=d??t.defaultOptions.texture,this.roundPixels=l??!1,this._anchor=new c({_onUpdate:()=>{this.onViewUpdate()}}),h?this.anchor=h:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return this._width}set width(t){this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this._height=t,this.onViewUpdate()}setSize(t,i){"object"==typeof t&&(i=t.height??t.width,t=t.width),this._width=t,this._height=i??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=u.EMPTY);const i=this._texture;i!==t&&(i&&i.dynamic&&i.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(t){super.destroy(t);if("boolean"==typeof t?t:t?.texture){const i="boolean"==typeof t?t:t?.textureSource;this._texture.destroy(i)}this._texture=null}updateBounds(){const t=this._bounds,i=this._anchor,e=this._width,s=this._height;t.minX=-i._x*e,t.maxX=t.minX+e,t.minY=-i._y*s,t.maxY=t.minY+s}};E.defaultOptions={texture:u.EMPTY};let D=E;var H,R={},j={};function W(){if(H)return j;H=1,Object.defineProperty(j,"__esModule",{value:!0}),j.Collector=void 0;return j.Collector=class{constructor(t){this.emit=(...i)=>{t.emitCollecting(this,i)}}},j}var F,z={};var N,L={};var X,Y={};var G,J={};var $,K={},Q={};var Z,q,tt={};function it(){if(q)return K;q=1,Object.defineProperty(K,"__esModule",{value:!0}),K.Signal=void 0;const t=($||($=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.SignalConnectionImpl=void 0,Q.SignalConnectionImpl=class{constructor(t,i){this.link=t,this.parentCleanup=i}disconnect(){return null!==this.link&&(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0)}set enabled(t){this.link&&this.link.setEnabled(t)}get enabled(){return null!==this.link&&this.link.isEnabled()}}),Q),i=(Z||(Z=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.SignalLink=void 0,tt.SignalLink=class t{constructor(t=null,i=null,e=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=null!=t?t:this,this.next=null!=i?i:this,this.order=e}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(i,e){let s=this.prev;for(;s!==this&&!(s.order<=e);)s=s.prev;const h=new t(s,s.next,e);return h.callback=i,s.next=h,h.next.prev=h,h}}),tt);return K.Signal=class{constructor(){this.head=new i.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(i,e=0){this.connectionsCount++;const s=this.head.insert(i,e);return this.emitDepth>0&&(this.hasNewLinks=!0,s.newLink=!0),new t.SignalConnectionImpl(s,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(t){for(let i=this.head.next;i!==this.head;i=i.next)if(i.callback===t)return this.decrementConnectionCount(),i.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...t){this.emitDepth++;for(let i=this.head.next;i!==this.head;i=i.next)i.isEnabled()&&i.callback&&i.callback.apply(null,t);this.emitDepth--,this.unsetNewLink()}emitCollecting(t,i){this.emitDepth++;for(let e=this.head.next;e!==this.head;e=e.next)if(e.isEnabled()&&e.callback){const s=e.callback.apply(null,i);if(!t.handleResult(s))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&0===this.emitDepth){for(let t=this.head.next;t!==this.head;t=t.next)t.newLink=!1;this.hasNewLinks=!1}}},K}var et,st,ht={};var nt=(st||(st=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalConnections=t.Signal=t.CollectorWhile0=t.CollectorUntil0=t.CollectorLast=t.CollectorArray=t.Collector=void 0;var i=W();Object.defineProperty(t,"Collector",{enumerable:!0,get:function(){return i.Collector}});var e=function(){if(F)return z;F=1,Object.defineProperty(z,"__esModule",{value:!0}),z.CollectorArray=void 0;const t=W();let i=class extends t.Collector{constructor(){super(...arguments),this.result=[]}handleResult(t){return this.result.push(t),!0}getResult(){return this.result}reset(){this.result.length=0}};return z.CollectorArray=i,z}();Object.defineProperty(t,"CollectorArray",{enumerable:!0,get:function(){return e.CollectorArray}});var s=function(){if(N)return L;N=1,Object.defineProperty(L,"__esModule",{value:!0}),L.CollectorLast=void 0;const t=W();let i=class extends t.Collector{handleResult(t){return this.result=t,!0}getResult(){return this.result}reset(){delete this.result}};return L.CollectorLast=i,L}();Object.defineProperty(t,"CollectorLast",{enumerable:!0,get:function(){return s.CollectorLast}});var h=function(){if(X)return Y;X=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.CollectorUntil0=void 0;const t=W();let i=class extends t.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,this.result}getResult(){return this.result}reset(){this.result=!1}};return Y.CollectorUntil0=i,Y}();Object.defineProperty(t,"CollectorUntil0",{enumerable:!0,get:function(){return h.CollectorUntil0}});var n=function(){if(G)return J;G=1,Object.defineProperty(J,"__esModule",{value:!0}),J.CollectorWhile0=void 0;const t=W();let i=class extends t.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,!this.result}getResult(){return this.result}reset(){this.result=!1}};return J.CollectorWhile0=i,J}();Object.defineProperty(t,"CollectorWhile0",{enumerable:!0,get:function(){return n.CollectorWhile0}});var o=it();Object.defineProperty(t,"Signal",{enumerable:!0,get:function(){return o.Signal}});var r=(et||(et=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.SignalConnections=void 0,ht.SignalConnections=class{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(const t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return 0===this.list.length}}),ht);Object.defineProperty(t,"SignalConnections",{enumerable:!0,get:function(){return r.SignalConnections}})}(R)),R),ot=Object.defineProperty,rt=(t,i,e)=>((t,i,e)=>i in t?ot(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class at{constructor(){rt(this,"_isMouseIn",!1),rt(this,"_isDown",!1),rt(this,"onDown"),rt(this,"onUp"),rt(this,"onUpOut"),rt(this,"onOut"),rt(this,"onPress"),rt(this,"onHover"),this.onPress=new nt.Signal,this.onDown=new nt.Signal,this.onUp=new nt.Signal,this.onHover=new nt.Signal,this.onOut=new nt.Signal,this.onUpOut=new nt.Signal}connectEvents(t){y.any?(t.on("pointerdown",this.processDown,this),t.on("pointerup",this.processUp,this),t.on("pointerupoutside",this.processUpOut,this),t.on("pointerout",this.processOut,this),t.on("pointertap",this.processPress,this),t.on("pointerover",this.processOver,this)):(t.on("mousedown",this.processDown,this),t.on("mouseup",this.processUp,this),t.on("mouseupoutside",this.processUpOut,this),t.on("mouseout",this.processOut,this),t.on("click",this.processPress,this),t.on("mouseover",this.processOver,this))}disconnectEvents(t){y.any?(t.off("pointerdown",this.processDown,this),t.off("pointerup",this.processUp,this),t.off("pointerupoutside",this.processUpOut,this),t.off("pointerout",this.processOut,this),t.off("pointertap",this.processPress,this),t.off("pointerover",this.processOver,this)):(t.off("mousedown",this.processDown,this),t.off("mouseup",this.processUp,this),t.off("mouseupoutside",this.processUpOut,this),t.off("mouseout",this.processOut,this),t.off("click",this.processPress,this),t.off("mouseover",this.processOver,this))}processDown(t){this._isDown=!0,this.onDown.emit(this,t),this.down(t)}processUp(t){this._isDown&&(this.onUp.emit(this,t),this.up(t)),this._isDown=!1}processUpOut(t){this._isDown&&(this.onUp.emit(this,t),this.onUpOut.emit(this,t),this.up(t),this.upOut(t)),this._isDown=!1}processOut(t){this._isMouseIn&&(this._isMouseIn=!1,this.onOut.emit(this,t),this.out(t))}processPress(t){this._isDown=!1,this.onPress.emit(this,t),this.press(t)}processOver(t){y.any||(this._isMouseIn=!0,this.onHover.emit(this,t),this.hover(t))}down(t){}up(t){}upOut(t){}out(t){}press(t){}hover(t){}get isDown(){return this._isDown}}var dt=Object.defineProperty,lt=(t,i,e)=>((t,i,e)=>i in t?dt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class ct extends at{constructor(t){super(),lt(this,"_view"),t&&(this.view=t,this.enabled=!0)}set view(t){!!this._view&&this._view&&this.disconnectEvents(this._view),this._view=t,this.connectEvents(this._view)}get view(){return this._view}set enabled(t){this.view&&(this.view.eventMode=t?"static":"auto",this.view.cursor=t?"pointer":"default",!t&&this.isDown&&this.processUp())}get enabled(){return"static"===this.view?.eventMode}}class ut extends p{constructor(t){super(),lt(this,"button"),lt(this,"onDown"),lt(this,"onUp"),lt(this,"onUpOut"),lt(this,"onOut"),lt(this,"onPress"),lt(this,"onHover"),this.button=new ct(this),this.button.enabled=!0,t&&this.addChild(t),this.onPress=this.button.onPress,this.onDown=this.button.onDown,this.onUp=this.button.onUp,this.onHover=this.button.onHover,this.onOut=this.button.onOut,this.onUpOut=this.button.onUpOut}set enabled(t){this.button.enabled=t}get enabled(){return this.button.enabled}}function pt(t){return"string"==typeof t?_.from(t):t instanceof u?new _(t):t}let _t;_t="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};class gt{constructor(){gt.prototype.__init.call(this),gt.prototype.__init2.call(this),gt.prototype.__init3.call(this),gt.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return gt._shared||(gt._shared=new gt),gt._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=_t}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,i=!1){if(null==t&&(null==this._lastUpdateTime?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const e=Object.keys(this._tweens);if(0==e.length)return!1;for(let s=0;s<e.length;s++){const h=this._tweens[e[s]];h&&0==h.update(t,!0)&&!i&&delete this._tweens[e[s]]}return!0}}const wt={Linear:{None:t=>t}},ft={Geom:{Linear(t,i){const e=t.length-1,s=e*i,h=Math.floor(s),n=ft.Utils.Linear;return i<0?n(t[0],t[1],s):i>1?n(t[e],t[e-1],e-s):n(t[h],t[h+1>e?e:h+1],s-h)}},Utils:{Linear:(t,i,e)=>(i-t)*e+t}};class mt{static __initStatic(){this._nextId=0}static nextId(){return mt._nextId++}}mt.__initStatic();const vt={safetyCheckFunction:t=>!0,easingFunction:wt.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:ft.Geom.Linear};class xt{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!=0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=vt.safetyCheckFunction}__init15(){this._easingFunction=vt.easingFunction}__init16(){this._yoyoEasingFunction=vt.yoyoEasingFunction}__init17(){this._interpolationFunction=vt.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=mt.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:gt.shared}set _group(t){this._groupRef=t}constructor(t,i){xt.prototype.__init.call(this),xt.prototype.__init2.call(this),xt.prototype.__init3.call(this),xt.prototype.__init4.call(this),xt.prototype.__init5.call(this),xt.prototype.__init6.call(this),xt.prototype.__init7.call(this),xt.prototype.__init8.call(this),xt.prototype.__init9.call(this),xt.prototype.__init10.call(this),xt.prototype.__init11.call(this),xt.prototype.__init12.call(this),xt.prototype.__init13.call(this),xt.prototype.__init14.call(this),xt.prototype.__init15.call(this),xt.prototype.__init16.call(this),xt.prototype.__init17.call(this),xt.prototype.__init18.call(this),xt.prototype.__init19.call(this),xt.prototype.__init20.call(this),xt.prototype.__init21.call(this),xt.prototype.__init22.call(this),this._object=t,this._group=i}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch(i){throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,i){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch(e){return this.dynamicTo(t,i)}return void 0!==i&&(this._duration=i),this}dynamicTo(t,i){return this._valuesEnd=t,void 0!==i&&(this._duration=i),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying||(null!=t&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1)),this}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);const t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,i,e,s,h){for(const n in e){const o=t[n],r=Array.isArray(o),a=!Number.isNaN(Number(o)),d=r?"array":typeof o,l="object"==d,c="object"==typeof e[n],u=!r&&Array.isArray(e[n]);"undefined"!=d&&"function"!=d&&null!=e[n]&&(r||a||l)&&((l||r||c)&&o&&!u?(void 0===i[n]&&(i[n]=r?[]:{}),void 0===s[n]&&(s[n]=r?[]:{}),this._setupProperties(o,i[n],e[n],s[n],h)):((void 0===i[n]||h)&&(i[n]=o),(void 0===s[n]||h)&&(s[n]=u?e[n].slice().reverse()[0]:i[n]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let i=[];if(t||(i=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=i;for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].start()}return this}skip(t,i=!1){return this.resume(),this.update(t*this._duration-(i?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this}resume(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this}stopChainedTweens(){for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let i=0,e=this._chainedTweens.length;i<e;i++)this._chainedTweens[i].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,i=!1){const e=this._internalUpdate(t);return e||i||this._group.remove(this),e}_internalUpdate(t){if(!this._safetyCheckFunction(this._object))return!1;if(this._isPaused)return!1;let i;t*=this._timescale,this._elapsedTime+=t;const e=this._duration,s=this._startTime+this._elapsedTime;if(s>e&&!this._isPlaying)return!1;this.isPlaying||this.start(),0==this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),0==this._onAfterDelayCallbackFired&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),i=s/this._duration,0==this._duration&&(i=s>=0?1:0),i=Math.min(1,i),i=Math.max(0,i);let h=Number.isFinite(s)?s%this._duration:s;Number.isNaN(h)&&(h=0);const n=Math.floor(s/this._duration);let o;if(o=this._reversed&&this._yoyoEasingFunction?this._yoyoEasingFunction(i):this._easingFunction(i),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&(1!=i||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,i,this),1==i){if(this._repeat-this._repeatCount>0){const t=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+n),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||h<=0)&&this._onUpdateCallback(this._object,i,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),void 0!==this._repeatDelayTime?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let i=1;Number.isFinite(n)?i=this._repeatCount-t:Number.isFinite(this._repeat)&&(i=this._repeat-t);for(let e=0;e<i;e++)this._onRepeatCallback(this._object,t+1+e,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return h>0&&Number.isFinite(this._repeat)&&this._internalUpdate(h),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].start(),h>0&&this._chainedTweens[t].update(h);return this._isPlaying=!1,!1}return!0}_updateProperties(t,i,e,s){for(const h in e){if(null==i[h])continue;const n=i[h];let o=e[h];const r=Array.isArray(t[h]),a=Array.isArray(o);!r&&a?this._reversed?t[h]=this._interpolationFunction(o.concat([n]),s):t[h]=this._interpolationFunction([n].concat(o),s):"object"==typeof o&&o?this._updateProperties(t[h],n,o,s):(o=this._handleRelativeValue(n,o),"number"!=typeof o||"number"!=typeof n&&"string"!=typeof n||(t[h]=Number(n)+(o-Number(n))*s,"string"==typeof n&&(t[h]=String(t[h]))))}}_handleRelativeValue(t,i){return"string"!=typeof i?i:"+"==i.charAt(0)||"-"==i.charAt(0)?t+Number(i):Number(i)}_swapEndStartRepeatValues(t,i){for(const e in t){const s=!Array.isArray(t[e])&&Array.isArray(i[e]);if("object"==typeof t[e])this._swapEndStartRepeatValues(t[e],i[e]);else{const h=t[e];if("string"==typeof i[e])t[e]=Number(t[e])+Number(i[e]),i[e]=h;else if(s){const s=i[e].slice().reverse();t[e]=s[0],i[e]=s}else t[e]=i[e],i[e]=h}}}_moveForwardStartRepeatValues(t,i){for(const e in t)"object"==typeof i[e]?this._moveForwardStartRepeatValues(t[e],i[e]):"string"==typeof i[e]&&(t[e]=Number(t[e])+Number(i[e]))}}function bt(t,i,e=0,s=!0){let h=i.scale.x,n=i.scale.y;if(!t)throw new Error("Parent is not defined");const o=t.width-2*e,r=t.height-2*e,a=o-Math.round(i.width),d=r-Math.round(i.height);if(a<0&&(h=o/(i.width/h)),d<0&&(n=r/(i.height/n)),h<=0||n<=0)i.scale.set(0);else if(s||i.scale.x===i.scale.y){const t=Math.min(h,n);i.scale.set(t,t)}else{const t=i.scale.x/i.scale.y;a<d?i.scale.set(h,h/t):i.scale.set(n*t,n)}}var yt=Object.defineProperty,St=(t,i,e)=>((t,i,e)=>i in t?yt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class Vt extends ut{constructor(t){super(),St(this,"animations"),St(this,"originalInnerViewState"),St(this,"defaultDuration",100),St(this,"options"),St(this,"_padding",0),St(this,"_offset",{}),St(this,"_textOffset",{}),St(this,"iconOffset",{}),St(this,"innerView",new p),St(this,"_views",{}),St(this,"state","default"),St(this,"anchor"),St(this,"_defaultTextScale",{x:1,y:1}),St(this,"_defaultIconScale",{x:1,y:1}),St(this,"_defaultTextAnchor",{x:.5,y:.5}),St(this,"_defaultIconAnchor",{x:.5,y:.5}),this.options=t??{};const{defaultView:i,hoverView:e,pressedView:s,disabledView:h,text:n,padding:o,offset:r,textOffset:a,iconOffset:d,defaultTextScale:l,defaultIconScale:u,defaultTextAnchor:_,defaultIconAnchor:g,scale:f,anchor:m,anchorX:v,anchorY:x,icon:b,animations:y}=t??{};this.addChild(this.innerView),this.anchor=new c({_onUpdate:()=>this.updateAnchor()}),this.anchor.set(v??m??0,x??m??0),this.padding=o??0,this.offset=r??{},this.textOffset=a??{},this.iconOffset=d??{},this.defaultTextScale=l??{x:1,y:1},this.defaultIconScale=u??{x:1,y:1},this.defaultTextAnchor=_??{x:.5,y:.5},this.defaultIconAnchor=g??{x:.5,y:.5},this.scale.set(f??1),y&&(this.animations=y,this.setOriginalInnerViewState(),w.shared.add(()=>gt.shared.update())),this.setState("default"),this.defaultView=i,this.hoverView=e,this.pressedView=s,this.disabledView=h,this.text=n??"",void 0!==b&&(this.iconView=b),this.initStateControl()}set text(t){t&&0!==t?this._views.textView?this._views.textView.text=t.toString():this.createTextView(t):this.removeView("textView")}get text(){return this._views.textView?.text}set enabled(t){this.button.enabled=t,this.setState(t?"default":"disabled")}get enabled(){return this.button.enabled}setState(t,i=!1){if(!i&&this.state===t)return;const e=this.getStateView(this.state);e&&(e.visible=!1),this.state=t;const s=this.getStateView(t);s&&(this.setOffset(s,t,this.offset),s.visible=!0),this.updateAnchor(),this.playAnimations(t)}createTextView(t){if(this._views.textView=function(t){return"string"==typeof t||"number"==typeof t?new g({text:String(t)}):t}(t),void 0===this.options?.defaultTextScale){const{x:t,y:i}=this._views.textView.scale;this._defaultTextScale={x:t,y:i}}this.innerView.addChild(this._views.textView),this.adjustTextView(this.state)}setOffset(t,i,e){const s=e?e[i]:{x:0,y:0},h=e?.default;s?(t.x+=s.x??0,t.y+=s.y??0):h?(t.x+=h.x??0,t.y+=h.y??0):(e.x||e.y)&&(t.x+=e.x??0,t.y+=e.y??0)}getStateView(t){if(this._views)switch(t){case"hover":return this._views.hoverView??this._views.defaultView??void 0;case"pressed":return this._views.pressedView??this._views.hoverView??this._views.defaultView??void 0;case"disabled":return this._views.disabledView??this._views.defaultView??void 0;case"default":return this._views.defaultView??void 0;default:return}}adjustTextView(t){if(!this.text)return;if(!this._views.textView)return;const i=this.getStateView(this.state),e=this._defaultTextAnchor.x??.5,s=this._defaultTextAnchor.y??.5;if(i){if(this.options?.ignoreRefitting||this._views.textView.scale.set(this._defaultTextScale.x,this._defaultTextScale.y),"default"===this.contentFittingMode&&bt(i,this._views.textView,this.padding,!1),"fill"===this.contentFittingMode){this._views.textView.scale.set(1);const t=i.width-2*this.padding,e=i.height-2*this.padding,s=t/this._views.textView.width,h=e/this._views.textView.height,n=Math.min(s,h);this._views.textView.scale.set(n*(this._defaultTextScale.x??1),n*(this._defaultTextScale.y??1))}this._views.textView.x=i.x+i.width/2,this._views.textView.y=i.y+i.height/2}this._views.textView.anchor.set(e,s),this.setOffset(this._views.textView,t,this.textOffset)}adjustIconView(t){if(!this._views.iconView)return;const i=this.getStateView(t);if(!i)return;if(this.options?.ignoreRefitting||this._views.iconView.scale.set(this._defaultIconScale.x,this._defaultIconScale.y),"default"===this.contentFittingMode&&bt(i,this._views.iconView,this.padding,!1),"fill"===this.contentFittingMode){this._views.iconView.scale.set(1);const t=i.width-2*this.padding,e=i.height-2*this.padding,s=t/this._views.iconView.width,h=e/this._views.iconView.height,n=Math.min(s,h);this._views.iconView.scale.set(n*(this._defaultIconScale.x??1),n*(this._defaultIconScale.y??1))}const e=this._defaultIconAnchor.x??.5,s=this._defaultIconAnchor.y??.5;"anchor"in this._views.iconView?this._views.iconView.anchor.set(e,s):this._views.iconView.pivot.set(e*(this._views.iconView.width/this._views.iconView.scale.x),s*(this._views.iconView.height/this._views.iconView.scale.y)),this._views.iconView.x=i.x+i.width/2,this._views.iconView.y=i.y+i.height/2,this.setOffset(this._views.iconView,t,this.iconOffset)}updateAnchor(){if(!this._views)return;const t=this.anchor.x??0,i=this.anchor.y??0;if([this._views.defaultView,this._views.hoverView,this._views.pressedView,this._views.disabledView].forEach(e=>{e&&(e.anchor?.set(0),e.x=-e.width*t,e.y=-e.height*i)}),this._views.defaultView){const{x:t,y:i,width:e,height:s}=this._views.defaultView;this.hitArea=new f(t,i,e,s)}this.adjustIconView(this.state),this.adjustTextView(this.state)}set contentFittingMode(t){this.options.contentFittingMode=t}get contentFittingMode(){return this.options.contentFittingMode??"default"}set defaultView(t){this.updateView("defaultView",t),this._views.disabledView&&"default"!==this.state&&(this._views.disabledView.visible=!1)}get defaultView(){return this._views.defaultView}set hoverView(t){this.updateView("hoverView",t),this._views.hoverView&&"hover"!==this.state&&(this._views.hoverView.visible=!1)}get hoverView(){return this._views.hoverView}set pressedView(t){this.updateView("pressedView",t),this._views.pressedView&&"pressed"!==this.state&&(this._views.pressedView.visible=!1)}get pressedView(){return this._views.pressedView}set disabledView(t){this.updateView("disabledView",t),this._views.disabledView&&"disabled"!==this.state&&(this._views.disabledView.visible=!1)}get disabledView(){return this._views.disabledView}updateView(t,i){void 0!==i&&(this.removeView(t),this.options?.nineSliceSprite&&("string"==typeof i?this._views[t]=new D({texture:u.from(i),leftWidth:this.options.nineSliceSprite[0],topHeight:this.options.nineSliceSprite[1],rightWidth:this.options.nineSliceSprite[2],bottomHeight:this.options.nineSliceSprite[3]}):i instanceof u&&(this._views[t]=new D({texture:i,leftWidth:this.options.nineSliceSprite[0],topHeight:this.options.nineSliceSprite[1],rightWidth:this.options.nineSliceSprite[2],bottomHeight:this.options.nineSliceSprite[3]}))),this._views[t]||(this._views[t]=pt(i)),this.setOffset(this._views[t],this.state,this.offset),this._views[t].parent||this.innerView.addChild(this._views[t]),this.updateAnchor(),this._views.iconView&&this.innerView.addChild(this._views.iconView),this._views.textView&&this.innerView.addChild(this._views.textView),this.setState(this.state,!0))}removeView(t){this._views[t]&&(this.innerView.removeChild(this._views[t]),this._views[t]=void 0)}set textView(t){void 0!==t&&(this.removeView("textView"),null!==t&&this.createTextView(t))}get textView(){return this._views.textView}set iconView(t){if(void 0!==t&&(this.removeView("iconView"),null!==t)){if(this._views.iconView=pt(t),void 0===this.options?.defaultIconScale){const{x:t,y:i}=this._views.iconView.scale;this._defaultIconScale={x:t,y:i}}this._views.iconView.parent||this.innerView.addChild(this._views.iconView),this.setState(this.state,!0)}}get iconView(){return this._views.iconView}playAnimations(t){if(!this.animations)return;const i=this.animations[t]??this.animations.default;if(i){const t=i;return this.defaultDuration=t.duration??this.defaultDuration,void new xt(this.innerView).to(t.props,t.duration).start()}new xt(this.innerView).to(this.originalInnerViewState,this.defaultDuration).start()}setOriginalInnerViewState(){this.originalInnerViewState={x:this.innerView.x,y:this.innerView.y,width:this.innerView.width,height:this.innerView.height,scale:{x:this.innerView.scale.x,y:this.innerView.scale.y}};const t=this.animations?.default;t&&(this.innerView.x=t.props.x??this.originalInnerViewState.x??0,this.innerView.y=t.props.y??this.originalInnerViewState.y??0,this.innerView.width=t.props.width??this.originalInnerViewState.width??0,this.innerView.height=t.props.height??this.originalInnerViewState.height??0,this.innerView.scale.x=t.props.scale?.x??this.originalInnerViewState.scale?.x??1,this.innerView.scale.y=t.props.scale?.y??this.originalInnerViewState.scale?.y??1)}initStateControl(){this.onDown.connect(()=>{this.setState("pressed")}),this.onUp.connect(()=>{this.setState(y.any?"default":"hover")}),this.onUpOut.connect(()=>{this.setState("default")}),this.onOut.connect(()=>{this.button.isDown||this.setState("default")}),this.onPress.connect(()=>{this.setState(y.any?"default":"hover")}),this.onHover.connect(()=>{this.button.isDown||this.setState(y.any?"default":"hover")})}set padding(t){this._padding=t,this.adjustTextView(this.state),this.adjustIconView(this.state)}get padding(){return this._padding}set offset(t){this._offset=t,this.updateAnchor()}get offset(){return this._offset}set textOffset(t){this._textOffset=t,this.adjustTextView(this.state)}get textOffset(){return this._textOffset}set defaultTextScale(t){if(void 0===t)return;this.options.defaultTextScale=t;const i="number"==typeof t;this._defaultTextScale.x=i?t:t.x??1,this._defaultTextScale.y=i?t:t.y??1,this.adjustTextView(this.state)}get defaultTextScale(){return this.defaultTextScale}set defaultIconScale(t){if(void 0===t)return;this.options.defaultIconScale=t;const i="number"==typeof t;this._defaultIconScale.x=i?t:t.x??1,this._defaultIconScale.y=i?t:t.y??1,this.adjustIconView(this.state)}get defaultIconScale(){return this.defaultIconScale}set defaultTextAnchor(t){if(void 0===t)return;this.options.defaultTextAnchor=t;const i="number"==typeof t;this._defaultTextAnchor.x=i?t:t.x??1,this._defaultTextAnchor.y=i?t:t.y??1,this.adjustTextView(this.state)}get defaultTextAnchor(){return this.defaultTextAnchor}set defaultIconAnchor(t){if(void 0===t)return;this.options.defaultIconAnchor=t;const i="number"==typeof t;this._defaultIconAnchor.x=i?t:t.x??1,this._defaultIconAnchor.y=i?t:t.y??1,this.adjustIconView(this.state)}get defaultIconAnchor(){return this.defaultIconAnchor}set width(t){this.options?.nineSliceSprite?(this._views.defaultView&&(this._views.defaultView.width=t),this._views.hoverView&&(this._views.hoverView.width=t),this._views.pressedView&&(this._views.pressedView.width=t),this._views.disabledView&&(this._views.disabledView.width=t),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.width=t}get width(){return super.width}set height(t){this.options?.nineSliceSprite?(this._views.defaultView&&(this._views.defaultView.height=t),this._views.hoverView&&(this._views.hoverView.height=t),this._views.pressedView&&(this._views.pressedView.height=t),this._views.disabledView&&(this._views.disabledView.height=t),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.height=t}get height(){return super.height}setSize(t,i){this.options?.nineSliceSprite?(this._views.defaultView&&this._views.defaultView.setSize(t,i),this._views.hoverView&&this._views.hoverView.setSize(t,i),this._views.pressedView&&this._views.pressedView.setSize(t,i),this._views.disabledView&&this._views.disabledView.setSize(t,i),this.adjustTextView(this.state),this.adjustIconView(this.state),this.updateAnchor()):super.setSize(t,i)}}var Ct=Object.defineProperty,Pt=(t,i,e)=>((t,i,e)=>i in t?Ct(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class kt extends p{constructor(t){super(),Pt(this,"options"),Pt(this,"_type","bidirectional"),Pt(this,"_maxWidth",0),Pt(this,"children",[]),t&&(t.maxWidth&&(this._maxWidth=t.maxWidth),this.init(t)),t?.items?.forEach(t=>this.addChild(t)),this.on("added",()=>this.arrangeChildren()),this.on("childAdded",()=>this.arrangeChildren())}init(t){this.options=t,t?.type&&(this.type=t.type),t?.children&&t.children.forEach(t=>this.addChild(t))}set type(t){this._type=t,this.arrangeChildren()}get type(){return this._type}set elementsMargin(t){if(!this.options)throw new Error("List has not been initiated!");this.options.elementsMargin=t,this.arrangeChildren()}get elementsMargin(){return this.options?.elementsMargin??0}set padding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.padding=t,this.options.vertPadding=t,this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get padding(){return this.options?.padding??0}set vertPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.vertPadding=t,this.options.topPadding=t,this.options.bottomPadding=t,this.arrangeChildren()}get vertPadding(){return this.options?.vertPadding??this.padding??0}set horPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.horPadding=t,this.options.leftPadding=t,this.options.rightPadding=t,this.arrangeChildren()}get horPadding(){return this.options?.horPadding??this.padding??0}set leftPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.leftPadding=t,this.arrangeChildren()}get leftPadding(){return this.options?.leftPadding??this.horPadding}set rightPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.rightPadding=t,this.arrangeChildren()}get rightPadding(){return this.options?.rightPadding??this.horPadding}set topPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.topPadding=t,this.arrangeChildren()}get topPadding(){return this.options?.topPadding??this.vertPadding}set bottomPadding(t){if(!this.options)throw new Error("List has not been initiated!");this.options.bottomPadding=t,this.arrangeChildren()}get bottomPadding(){return this.options?.bottomPadding??this.vertPadding}arrangeChildren(){let t=0,i=this.leftPadding,e=this.topPadding;const s=this.options?.elementsMargin??0;let h=this.maxWidth||this.parent?.width;this.rightPadding&&(h-=this.rightPadding),this.children.forEach((n,o)=>{switch(this.type){case"vertical":n.y=e,n.x=i,e+=s+n.height;break;case"horizontal":n.x=i,n.y=e,i+=s+n.width;break;default:n.x=i,n.y=e,n.x+n.width>h&&o>0&&(e+=s+t,i=this.leftPadding,n.x=i,n.y=e,t=0),t=Math.max(t,n.height),i+=s+n.width}})}removeItem(t){const i=this.children[t];i&&(this.removeChild(i),this.arrangeChildren())}set maxWidth(t){this._maxWidth=t,this.arrangeChildren()}get maxWidth(){return this._maxWidth}}var Tt=Object.defineProperty,It=(t,i,e)=>((t,i,e)=>i in t?Tt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class At{constructor(t={}){It(this,"x"),It(this,"ax"),It(this,"dx"),It(this,"tx"),It(this,"_options"),this.x=0,this.ax=0,this.dx=0,this.tx=0,this._options={max:t.max??160,damp:t.damp??.8,springiness:t.springiness??.1}}update(){this.ax=(this.tx-this.x)*this._options.springiness,this.dx+=this.ax,this.dx*=this._options.damp,this.dx<-this._options.max?this.dx=-this._options.max:this.dx>this._options.max&&(this.dx=this._options.max),this.x+=this.dx}reset(){this.x=0,this.ax=0,this.dx=0,this.tx=0}get max(){return this._options.max}set max(t){this._options.max=t}get damp(){return this._options.damp}set damp(t){this._options.damp=t}get springiness(){return this._options.springiness}set springiness(t){this._options.springiness=t}}var Ot=Object.defineProperty,Mt=(t,i,e)=>((t,i,e)=>i in t?Ot(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class Bt{constructor(){Mt(this,"done",!1),Mt(this,"to",0),Mt(this,"_spring"),Mt(this,"_pos",0),Mt(this,"_speed",0),Mt(this,"_correctSpeed",!1),this._spring=new At,this._pos=0,this.to=0}start(t,i,e){this._speed=t,this._pos=i,this.to=e,this.done=!1,this._spring.x=this._pos,this._spring.tx=this.to;const s=this.to-this._pos,h=Math.abs(s)/s,n=Math.abs(this._speed)/this._speed;this._correctSpeed=h!==n}update(){if(this._correctSpeed)this._speed*=.6,Math.abs(this._speed)<2&&(this._correctSpeed=!1),this._pos+=this._speed,this._spring.x=this._pos;else{const t=this.to-this._pos;Math.abs(t)<.05?(this._pos=this.to,this.done=!0):(this._spring.tx=this.to,this._spring.update(),this._pos=this._spring.x)}return this._pos}cancel(){}}var Ut=Object.defineProperty,Et=(t,i,e)=>((t,i,e)=>i in t?Ut(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class Dt{constructor(t={}){Et(this,"position",0),Et(this,"constrain",!0),Et(this,"min",0),Et(this,"max",0),Et(this,"maxSpeed",400),Et(this,"_ease"),Et(this,"_offset",0),Et(this,"_prev",0),Et(this,"_speed",0),Et(this,"_hasStopped",!1),Et(this,"_targetSpeed",0),Et(this,"_speedChecker",0),Et(this,"_grab",0),Et(this,"_activeEase"),this.constrain=t.constrain??!0,this.maxSpeed=t.maxSpeed??400,this._ease=t.ease??new Bt}set value(t){this._speed=0,this.position=t}get value(){return this.position}grab(t){this._grab=t,this._offset=this.position-t,this._speedChecker=0,this._targetSpeed=this._speed=0,this._hasStopped=!1}hold(t){this._speedChecker++,this.position=t+this._offset,this._speedChecker>1&&(this._targetSpeed=this.position-this._prev),this._speed+=(this._targetSpeed-this._speed)/2,this._speed>this.maxSpeed?this._speed=this.maxSpeed:this._speed<-this.maxSpeed&&(this._speed=-this.maxSpeed),this._prev=this.position,this.constrain&&(this._activeEase=void 0,this.position>this.min?this.position-=(this.position-this.min)/1.5:this.position<this.max&&(this.position+=(this.max-this.position)/1.5))}slide(t=!1){this._hasStopped||(this.constrain?this._updateConstrain(t):this._updateDefault())}get moveAmount(){return-(this.position-this._offset-this._grab)}_updateDefault(){this._speed*=.9,this.position+=this._speed,(this._speed<0?-1*this._speed:this._speed)<.01&&(this._hasStopped=!0)}_updateConstrain(t=!1){const i=this.max;t?(this.value>0&&(this.value=0),this.value>0&&(this.value=0),this.value<this.max&&(this.value=this.max),this.value<this.max&&(this.value=this.max)):this.position>this.min||this.position<i||this._activeEase?(this._activeEase||(this._activeEase=this._ease,this.position>this.min?this._activeEase.start(this._speed,this.position,this.min):this._activeEase.start(this._speed,this.position,i)),this.position=this._activeEase.update(),this._activeEase.done&&(this.position=this._activeEase.to,this._speed=0,this._activeEase=void 0)):this._updateDefault()}}var Ht=Object.defineProperty,Rt=(t,i,e)=>((t,i,e)=>i in t?Ht(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class jt{constructor(t){Rt(this,"xAxis"),Rt(this,"yAxis"),Rt(this,"_isDown",!1),Rt(this,"_globalPosition"),Rt(this,"_frame"),Rt(this,"_bounds"),Rt(this,"_dirty",!1),Rt(this,"disableEasing",!1),this.xAxis=new Dt({ease:t.xEase,maxSpeed:t.maxSpeed,constrain:t.constrain}),this.yAxis=new Dt({ease:t.yEase,maxSpeed:t.maxSpeed,constrain:t.constrain}),this.disableEasing=t.disableEasing??!1,this._frame=new f,this._bounds=new f,this._globalPosition=new m}pointerDown(t){this._globalPosition=t,this.xAxis.grab(t.x),this.yAxis.grab(t.y),this._isDown=!0}pointerUp(){this._isDown=!1}pointerMove(t){this._globalPosition=t}update(){this._dirty&&this._bounds&&this._frame&&(this._dirty=!1,this.xAxis.min=this._bounds.left,this.xAxis.min=this._bounds.right-this._frame.width,this.xAxis.min=this._bounds.top,this.xAxis.min=this._bounds.bottom-this._frame.height),this._isDown&&this._globalPosition?(this.xAxis.hold(this._globalPosition.x),this.yAxis.hold(this._globalPosition.y)):(this.xAxis.slide(this.disableEasing),this.yAxis.slide(this.disableEasing))}resize(t,i){this._frame&&(this._frame.x=0,this._frame.width=t,this._frame.y=0,this._frame.height=i,this._dirty=!0)}setBounds(t,i,e,s){this._bounds&&(this._bounds.x=t,this._bounds.width=i-t,this._bounds.y=e,this._bounds.height=s-e,this._dirty=!0)}get x(){return this.xAxis.value}get y(){return this.yAxis.value}}var Wt=Object.defineProperty,Ft=(t,i,e)=>((t,i,e)=>i in t?Wt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class zt extends p{constructor(t){super(),Ft(this,"background"),Ft(this,"borderMask"),Ft(this,"lastWidth",0),Ft(this,"lastHeight",0),Ft(this,"_width",0),Ft(this,"_height",0),Ft(this,"_dimensionChanged",!1),Ft(this,"list"),Ft(this,"_trackpad"),Ft(this,"isDragging",0),Ft(this,"interactiveStorage",[]),Ft(this,"visibleItems",[]),Ft(this,"pressedChild"),Ft(this,"ticker",w.shared),Ft(this,"options",{}),Ft(this,"stopRenderHiddenItemsTimeout"),Ft(this,"onMouseScrollBinding",this.onMouseScroll.bind(this)),Ft(this,"dragStarTouchPoint"),Ft(this,"isOver",!1),Ft(this,"proximityRange",0),Ft(this,"proximityStatusCache",[]),Ft(this,"lastScrollX"),Ft(this,"lastScrollY"),Ft(this,"proximityCheckFrameCounter",0),Ft(this,"onProximityChange",new nt.Signal),Ft(this,"onScroll",new nt.Signal),t&&this.init(t),this.ticker.add(this.update,this)}init(t){this.options=t,this.setBackground(t.background),this._width=t.width??this.background?.width??100,this._height=t.height??this.background?.height??100,this.proximityRange=t.proximityRange??0,this.list||(this.list=new kt,super.addChild(this.list)),this.list?.init({type:t.type,elementsMargin:t.elementsMargin,padding:t.padding,vertPadding:t.vertPadding,horPadding:t.horPadding,topPadding:t.topPadding,bottomPadding:t.bottomPadding,leftPadding:t.leftPadding,rightPadding:t.rightPadding,maxWidth:t.maxWidth||("horizontal"!==t.type&&"vertical"!==t.type?this._width:0)}),t.items&&this.addItems(t.items),this.hasBounds&&(this.addMask(),this.makeScrollable()),this._trackpad&&(this._trackpad.xAxis.value=0,this._trackpad.yAxis.value=0),this.options.globalScroll=t.globalScroll??!0,this.options.shiftScroll=t.shiftScroll??!1,this.resize()}get hasBounds(){return!!this._width||!!this._height}addItems(t){t?.length&&t.forEach(t=>this.addItem(t))}removeItems(){this.proximityStatusCache.length=0,this.list?.removeChildren()}addItem(...t){if(t.length>1)t.forEach(t=>this.addItem(t));else{const i=t[0];!i.width||i.height,i.eventMode="static",this.list?.addChild(i),this.proximityStatusCache.push(!1),this.options.disableDynamicRendering||(i.renderable=this.isItemVisible(i))}return this.resize(),t[0]}removeItem(t){this.list?.removeItem(t),this.proximityStatusCache.splice(t,1),this.resize()}isItemVisible(t,i=0){let e=!1;const s=this.list;if(!s)return!1;if(this.isVertical||this.isBidirectional){const h=t.y+s.y;h+t.height>=-i&&h<=(this.options.height??this._height)+i&&(e=!0)}if(this.isHorizontal||this.isBidirectional){const h=t.x+s.x;h+t.width>=-i&&h<=(this.options.width??this._width)+i&&(e=!0)}return e}get items(){return this.list?.children??[]}setBackground(t){this.background&&this.removeChild(this.background),this.options.background=t,this.background=new V,this.addChildAt(this.background,0),this.resize()}addMask(){this.borderMask||(this.borderMask=new V,super.addChild(this.borderMask),this.mask=this.borderMask),this.resize()}makeScrollable(){this._trackpad||(this._trackpad=new jt({disableEasing:this.options.disableEasing})),this.on("pointerdown",t=>{this.renderAllItems(),this.isDragging=1,this.dragStarTouchPoint=this.worldTransform.applyInverse(t.global),this._trackpad&&this.dragStarTouchPoint&&this._trackpad.pointerDown(new m(this.dragStarTouchPoint.x,this.dragStarTouchPoint.y));const i=this.list?.worldTransform.applyInverse(t.global);i&&this.visibleItems.forEach(t=>{t.x<i.x&&t.x+t.width>i.x&&t.y<i.y&&t.y+t.height>i.y&&(this.pressedChild=t)})}),this.on("pointerup",()=>{this.isDragging=0,this._trackpad?.pointerUp(),this.restoreItemsInteractivity(),this.pressedChild=void 0,this.stopRenderHiddenItems()}),this.on("pointerover",()=>{this.isOver=!0}),this.on("pointerout",()=>{this.isOver=!1}),this.on("pointerupoutside",()=>{this.isDragging=0,this._trackpad?.pointerUp(),this.restoreItemsInteractivity(),this.pressedChild=void 0,this.stopRenderHiddenItems()}),this.on("globalpointermove",t=>{if(!this.isDragging)return;const i=this.worldTransform.applyInverse(t.global);if(this.dragStarTouchPoint){const t=this.options.dragTrashHold??10;if(this.isHorizontal||this.isBidirectional){const e=i.x-this.dragStarTouchPoint.x;Math.abs(e)>t&&(this.isDragging=2)}if(this.isVertical||this.isBidirectional){const e=i.y-this.dragStarTouchPoint.y;Math.abs(e)>t&&(this.isDragging=2)}}this.dragStarTouchPoint&&2!==this.isDragging||(this._trackpad?.pointerMove(new m(i.x,i.y)),this.pressedChild&&(this.revertClick(this.pressedChild),this.pressedChild=void 0),this.isBidirectional?this.onScroll?.emit({x:this.scrollX,y:this.scrollY}):this.onScroll?.emit(this.isVertical?this.scrollY:this.scrollX))}),document.addEventListener("wheel",this.onMouseScrollBinding,!0)}setInteractive(t){this.eventMode=t?"static":"auto"}get listHeight(){return(this.list?.height??0)+(this.list?.topPadding??0)+(this.list?.bottomPadding??0)}get listWidth(){return(this.list?.width??0)+(this.list?.leftPadding??0)+(this.list?.rightPadding??0)}resize(t=!1){if(this.hasBounds){if(this.renderAllItems(),this.borderMask&&(t||this._dimensionChanged||this.lastWidth!==this.listWidth||this.lastHeight!==this.listHeight)){this.options.width||(this._width+=this.listWidth),this.options.height||(this._height+=this.listHeight),this.borderMask?.clear().roundRect(0,0,this._width,this._height,0|(this.options.radius??0)).fill(16711935).stroke(0),this.borderMask&&(this.borderMask.eventMode="none");const t=this.options.background;this.background?.clear().roundRect(0,0,this._width,this._height,0|(this.options.radius??0)).fill({color:t??0,alpha:t?1:1e-7}),this.isBidirectional?this.setInteractive(this.listWidth>this._width||this.listHeight>this._height):this.isHorizontal?this.setInteractive(this.listWidth>this._width):this.setInteractive(this.listHeight>this._height),this.lastWidth=this.listWidth,this.lastHeight=this.listHeight}if(this._trackpad&&this.borderMask){const t=this.borderMask.width-(this.list?.width??0)-(this.list?.leftPadding??0)-(this.list?.rightPadding??0),i=this.borderMask.height-(this.list?.height??0)-(this.list?.topPadding??0)-(this.list?.bottomPadding??0);this.isBidirectional?(this._trackpad.yAxis.max=-Math.abs(i),this._trackpad.xAxis.max=-Math.abs(t)):this.isVertical?this._trackpad.yAxis.max=-Math.abs(i):this.isHorizontal&&(this._trackpad.xAxis.max=-Math.abs(t))}this._dimensionChanged?(this.list?.arrangeChildren(),this.stopRenderHiddenItems(),this._dimensionChanged=!1):(t&&this.list?.arrangeChildren(),this.updateVisibleItems()),this.lastScrollX=void 0,this.lastScrollY=void 0}}onMouseScroll(t){if(!this.isOver&&!this.options.globalScroll)return;this.renderAllItems();const i=!!this.options.shiftScroll,e=i?void 0!==t.deltaX||void 0!==t.deltaY:void 0!==t.deltaX,s=void 0!==t.deltaY;if((this.isHorizontal||this.isBidirectional)&&e){const e=i||this.isBidirectional?t.deltaX:t.deltaY,s=(this.list?.x??0)-e;if(this.listWidth<this._width)this._trackpad&&(this._trackpad.xAxis.value=0);else{const t=this._width-this.listWidth,i=0;this._trackpad&&(this._trackpad.xAxis.value=Math.min(i,Math.max(t,s)))}}if((this.isVertical||this.isBidirectional)&&s){const i=(this.list?.y??0)-t.deltaY;if(this.listHeight<this._height)this._trackpad&&(this._trackpad.yAxis.value=0);else{const t=this._height-this.listHeight,e=0;this._trackpad&&(this._trackpad.yAxis.value=Math.min(e,Math.max(t,i)))}}this.isBidirectional&&(e||s)?this.onScroll?.emit({x:this._trackpad?.xAxis.value??0,y:this._trackpad?.yAxis.value??0}):this.isHorizontal&&e?this.onScroll?.emit(this._trackpad?.xAxis.value??0):this.isVertical&&s&&this.onScroll?.emit(this._trackpad?.yAxis.value??0),this.stopRenderHiddenItems()}scrollBottom(){this.interactive?this.scrollTo((this.list?.children.length??1)-1):this.scrollTop()}scrollTop(){this.renderAllItems(),this._trackpad&&(this._trackpad.xAxis.value=0,this._trackpad.yAxis.value=0),this.stopRenderHiddenItems()}renderAllItems(){clearTimeout(this.stopRenderHiddenItemsTimeout),this.stopRenderHiddenItemsTimeout=void 0,this.options.disableDynamicRendering||this.items.forEach(t=>{t.renderable=!0})}stopRenderHiddenItems(){this.options.disableDynamicRendering||(this.stopRenderHiddenItemsTimeout&&(clearTimeout(this.stopRenderHiddenItemsTimeout),this.stopRenderHiddenItemsTimeout=void 0),this.stopRenderHiddenItemsTimeout=setTimeout(()=>this.updateVisibleItems(),2e3))}updateVisibleItems(){this.visibleItems.length=0,this.items.forEach(t=>{t.renderable=this.isItemVisible(t),this.visibleItems.push(t)})}scrollTo(t){if(!this.interactive||!this._trackpad||!this.list)return;const i=this.list.children[t];i&&(this.renderAllItems(),this._trackpad.xAxis.value=this.isHorizontal||this.isBidirectional?this._width-i.x-i.width-this.list.rightPadding:0,this._trackpad.yAxis.value=this.isVertical||this.isBidirectional?this._height-i.y-i.height-this.list.bottomPadding:0,this.stopRenderHiddenItems())}scrollToPosition({x:t,y:i}){void 0===t&&void 0===i||(this.renderAllItems(),void 0!==t&&(this.scrollX=-t),void 0!==i&&(this.scrollY=-i),this.stopRenderHiddenItems())}get height(){return this._height}set height(t){this._height=t,this._dimensionChanged=!0,this.resize(),this.scrollTop()}get width(){return this._width}set width(t){this._width=t,this._dimensionChanged=!0,this.resize(),this.scrollTop()}setSize(t,i){"object"==typeof t?(i=t.height??t.width,t=t.width):i=i??t,this._width=t,this._height=i,this._dimensionChanged=!0,this.resize(),this.scrollTop()}getSize(t){return(t=t||{width:0,height:0}).width=this._width,t.height=this._height,t}get scrollX(){return this._trackpad?.xAxis.value??0}set scrollX(t){this._trackpad&&(this._trackpad.xAxis.value=t)}get scrollY(){return this._trackpad?.yAxis.value??0}set scrollY(t){this._trackpad&&(this._trackpad.yAxis.value=t)}update(){this.list&&this._trackpad&&(this._trackpad.update(),(this.isHorizontal||this.isBidirectional)&&this.list.x!==this._trackpad.x&&(this.list.x=this._trackpad.x),(this.isVertical||this.isBidirectional)&&this.list.y!==this._trackpad.y&&(this.list.y=this._trackpad.y),this.options.disableProximityCheck||this._trackpad.x===this.lastScrollX&&this._trackpad.y===this.lastScrollY||(this.proximityCheckFrameCounter++,this.proximityCheckFrameCounter>=(this.options.proximityDebounce??10)&&(this.items.forEach((t,i)=>{const e=this.isItemVisible(t,this.proximityRange);e!==this.proximityStatusCache[i]&&(this.proximityStatusCache[i]=e,this.onProximityChange.emit({item:t,index:i,inRange:e}))}),this.lastScrollX=this._trackpad.x,this.lastScrollY=this._trackpad.y,this.proximityCheckFrameCounter=0)))}destroy(t){this.ticker.remove(this.update,this),document.removeEventListener("wheel",this.onMouseScrollBinding,!0),this.background?.destroy(),this.list?.destroy(),super.destroy(t)}restoreItemsInteractivity(){this.interactiveStorage.forEach(t=>{t.item.eventMode=t.eventMode}),this.interactiveStorage.length=0}revertClick(t){"auto"!==t.eventMode&&(y.any?t.emit("pointerupoutside",{target:t}):t.emit("mouseupoutside",{target:t}),this.interactiveStorage.push({item:t,eventMode:t.eventMode??"auto"}),t.eventMode="auto"),t instanceof p&&t.children&&t.children.forEach(t=>this.revertClick(t))}get scrollHeight(){return this.list?.height??0}get scrollWidth(){return this.list?.width??0}get isVertical(){return"vertical"===(this.options.type??"vertical")}get isHorizontal(){return"horizontal"===this.options.type}get isBidirectional(){return"bidirectional"===this.options.type}}var Nt=Object.defineProperty,Lt=(t,i,e)=>((t,i,e)=>i in t?Nt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e)(t,"symbol"!=typeof i?i+"":i,e);class Xt extends p{constructor(t){super(),Lt(this,"view",new p),Lt(this,"openButton"),Lt(this,"closeButton"),Lt(this,"openView"),Lt(this,"scrollBox"),Lt(this,"value",-1),Lt(this,"onSelect"),this.addChild(this.view),this.onSelect=new nt.Signal,t&&this.init(t)}init({closedBG:t,textStyle:i,TextClass:e,items:s,openBG:h,selected:n,selectedTextOffset:o,scrollBox:r,visibleItems:a}){e=e??g,this.openView&&this.openView!==h&&this.view.removeChild(this.openView),this.openButton?(this.openButton.defaultView=pt(t),this.openButton.textView=new e({text:s?.items?s.items[0]:"",style:i}),this.openButton.textOffset=o??{}):(this.openButton=new Vt({defaultView:t,text:new e({text:s?.items?s.items[0]:"",style:i}),textOffset:o}),this.openButton.onPress.connect(()=>this.toggle()),this.addChild(this.openButton)),this.openView!==h&&(this.openView=pt(h),this.view.visible=!1,this.view.addChild(this.openView)),this.closeButton?(this.closeButton.defaultView=(new V).rect(0,0,this.openButton.width,this.openButton.height).fill({color:0,alpha:1e-5}),this.closeButton.textView=new e({text:s?.items?s.items[0]:"",style:i}),this.openButton.textOffset=o??{}):(this.closeButton=new Vt({defaultView:(new V).rect(0,0,this.openButton.width,this.openButton.height).fill({color:0,alpha:1e-5}),text:new e({text:s?.items?s.items[0]:"",style:i}),textOffset:o}),this.closeButton.onPress.connect(()=>this.toggle()),this.view.addChild(this.closeButton)),this.scrollBox?this.scrollBox.removeItems():(this.scrollBox=new zt,this.view.addChild(this.scrollBox)),this.scrollBox.init({type:"vertical",elementsMargin:0,width:this.openButton.width,height:this.openButton.height*(a??5),radius:0,padding:0,...r}),this.scrollBox.y=this.openButton.height,r?.offset&&(this.scrollBox.x=r.offset.x??0,this.scrollBox.y+=r.offset.y??0),this.addItems(s,n)}addItems(t,i=0){this.convertItemsToButtons(t).forEach((t,e)=>{const s=t.text;e===i&&(this.openButton.text=s??"",this.closeButton.text=s??""),t.onPress.connect(()=>{this.value=e,this.onSelect.emit(e,s??""),this.openButton.text=s??"",this.closeButton.text=s??"",this.close()}),this.scrollBox?.addItem(t)})}removeItem(t){this.scrollBox&&this.scrollBox.removeItem(t)}toggle(){this.view.visible=!this.view.visible,this.openButton.visible=!this.openButton.visible}open(){this.view.visible=!0,this.openButton.visible=!1}close(){this.view.visible=!1,this.openButton.visible=!0}convertItemsToButtons({items:t,backgroundColor:i,hoverColor:e,width:s,height:h,textStyle:n,TextClass:o,radius:r}){o=o??g;const a=[];return t.forEach(t=>{const d=(new V).roundRect(0,0,s,h,r).fill(i),l=e??i,c=(new V).roundRect(0,0,s,h,r).fill(l),u=new o({text:t,style:n}),p=new Vt({defaultView:d,hoverView:c,text:u});a.push(p)}),a}}class Yt extends p{constructor(t,i){super(),this.targetSize=i,this.item=t,this.sprite=new v(t,i,i),this.addChild(this.sprite);const e={fill:16777215,fontSize:20};this.nameText=new g(t.name,e),this.nameText.anchor.set(.5),this.nameText.position.set(48,110),this.descText=new g(t.description,e),this.descText.anchor.set(.5),this.descText.position.set(48,140),this.addChild(this.nameText),this.addChild(this.descText)}update(t){this.sprite.updateData?.(t),this.nameText.text=t.name,this.descText.text=t.description,this.item=t}showDetails(t=!0,i=!0){this.nameText.visible=t,this.descText.visible=i}}class Gt extends x{constructor(t){super(t),this.score=0,this.maxTrials=10,this.draggingSprite=null,this.dragOffset={x:0,y:0},this.recipeCounter={ok:0,hitTotal:0,missTotal:0},this.drawUI(),this.drawTarget()}getCountString(){return`Hit: ${this.recipeCounter.hitTotal} Miss: ${this.recipeCounter.missTotal}`}drawUI(){this.scoreText=new g(this.getCountString(),{fill:16777215,fontSize:18}),this.scoreText.position.set(20,20),this.hudContainer.addChild(this.scoreText);const t={fill:0,fontSize:20},i=[{name:"Base Combo items",cb:()=>{this.ctx.currentSet=this.ctx.sets.base}},{name:"Emblem Combo items",cb:()=>{this.ctx.currentSet=this.ctx.sets.emblem}},{name:"All Combo items",cb:()=>{this.ctx.currentSet=this.ctx.sets.all}}],e=new Xt({closedBG:(new V).roundRect(0,0,200,40,10).fill(13421772),openBG:(new V).roundRect(0,0,200,200,10).fill(15658734),textStyle:t,items:{items:i.map(t=>t.name),backgroundColor:15658734,hoverColor:14540253,width:200,height:40,textStyle:t},scrollBox:{width:200,height:160}});e.position.set(20,60),e.onSelect.connect((t,e)=>{const s=i.find(t=>t.name===e);s&&s.cb&&(s.cb(),this.ctx.goToScene(Gt))}),this.hudContainer.addChild(e),this.ctx.app.ticker.add(()=>{e&&e.update&&e.update()})}drawTarget(){if(this.targetItem)this.targetItem.update(this.ctx.currentSet.getRandomCombinedItem());else{this.targetItem=new Yt(this.ctx.currentSet.getRandomCombinedItem(),b);const t=this.gameAreaContainer.width,i=this.gameAreaContainer.height,e=b,s=b;this.targetItem.x=t/2-e/2,this.targetItem.y=i/2-s/2,this.gameAreaContainer.addChild(this.targetItem)}}findTargetTftItem(t){return t.id!==this.targetItem.item.id?null:this.targetItem.sprite}updateCounter(){this.scoreText.text=this.getCountString()}showTemporaryResult(t){const i=new _(u.from(`/items/${t.icon}`));i.width=80,i.height=80,i.position.set(this.ctx.app.screen.width/2-40,this.ctx.app.screen.height/2-40),i.alpha=.9,this.container.addChild(i);const e=new g(t.name,{fill:16777215,fontSize:20});e.anchor.set(.5),e.position.set(this.ctx.app.screen.width/2,this.ctx.app.screen.height/2+50),this.container.addChild(e),setTimeout(()=>{i.destroy(),e.destroy()},1e3)}onHit(t,i){this.recipeCounter.ok=0,this.recipeCounter.hitTotal++,this.updateCounter(),this.dragPanel.disableGlow(),this.drawTarget(),this.dragPanel.drawItems()}onMiss(t){this.recipeCounter.missTotal++,this.recipeCounter.missTotal%3==1&&this.dragPanel.glow(this.targetItem.item.recipe[0]),this.recipeCounter.missTotal%3==2&&this.dragPanel.glow(this.targetItem.item.recipe[1]),this.updateCounter()}destroy(){this.targetItem&&this.ctx.app.stage.off("pointermove",this.onDragMove,this),super.destroy()}}export{Gt as default};
