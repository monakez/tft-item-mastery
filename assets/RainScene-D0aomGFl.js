import{b as t,T as e}from"./index-eJpqKaHf.js";import{T as s,G as i}from"./GameScene-csI6bS_x.js";import"./Filter-Cw1r2BT3.js";import"./Graphics-B04i3yF2.js";import"./colorToUniform-DIWNkBfR.js";class h extends s{constructor(t){super(t,60,60),this.reset()}reset(){this.active=!1,this.visible=!1,this.interactive=!1,this.speed=0,this.targetY=0}launch(t,e,s=2){this.x=t,this.y=e,this.speed=s,this.active=!0,this.visible=!0,this.interactive=!0,this.targetY=e+100*(Math.random()-.5),this.wobblePhase=Math.random()*Math.PI*2}update(){if(this.active)return this.x-=this.speed,this.wobblePhase+=.05,this.y=this.targetY+10*Math.sin(this.wobblePhase),!(this.x<-this.width)||(this.deactivate(),!1)}deactivate(){this.active=!1,this.visible=!1,this.interactive=!1}}class a{constructor(t,e,s=20){this.ctx=t,this.container=e,this.pool=[],this.activeItems=new Set;const i=t.sets.all.combo.filter(t=>t.recipe&&t.recipe.length>0);if(0===i.length)throw new Error("BAD CONTEXT ITEMS. NO COMPOSITE RECIPES");for(let a=0;a<s;a++){const t=i[a%i.length],e=new h(t);this.container.addChild(e),this.pool.push(e)}}acquire(t,e,s){const i=this.pool.find(t=>!t.active);return i?(i.launch(t,e,s),this.activeItems.add(i),i):null}updateAll(){for(const t of this.activeItems){t.update()||(this.release(t),this.onMiss?.(t))}}release(t){t.deactivate(),this.activeItems.delete(t)}checkHit(t){for(const e of this.activeItems)if(e.isMatch(t))return this.release(e),!0;return!1}destroy(){for(const t of this.pool)t.destroy();this.pool=[],this.activeItems.clear()}}class o extends i{constructor(t){super(t),this.pool=new a(t,this.gameAreaContainer),this.pool.onMiss=this.onMiss,this.ctx.app.stage.on("pointerdown",this.onScreenClick,this),this.spawnInterval=setInterval(()=>{this.spawnFlyingItem()},1500),this.ctx.app.ticker.add(this.update,this)}onCombine=t=>{};onMiss=t=>{this.misses++,this.pool.release(t),this.misses>=10&&this.endGame()};endGame=()=>{};update(){this.pool.updateAll(this.ctx.app.ticker.deltaMS)}spawnFlyingItem(){const t=this.ctx.app.screen.width+50,e=Math.random()*(this.ctx.app.screen.height-200)+100,s=1.5+1.5*Math.random();this.pool.acquire(t,e,s)}onScreenClick(t){for(const e of this.pool.activeItems){const s=t.global.x-e.x,i=t.global.y-e.y;if(Math.sqrt(s*s+i*i)<30){this.onHit(e);break}}}onHit(t){this.createHitEffect(t.x,t.y),this.collectedItems.push(t.item),this.pool.release(t)}createHitEffect(s,i){const h=new t(e.WHITE);h.tint=65280,h.width=h.height=20,h.position.set(s,i),h.alpha=.8,this.gameAreaContainer.addChild(h),setTimeout(()=>h.destroy(),200)}destroy(){clearInterval(this.spawnInterval),this.ctx.app.stage.off("pointerdown",this.onScreenClick,this),this.ctx.app.ticker.remove(this.update,this),this.pool?.destroy(),super.destroy()}}export{o as default};
