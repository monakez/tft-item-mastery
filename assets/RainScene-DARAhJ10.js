import{S as n,T as c}from"./index-DPQEcIlb.js";import{T as l,G as p}from"./GameScene-BzHlmAAb.js";class d extends l{constructor(t){super(t,60,60),this.reset()}reset(){this.active=!1,this.visible=!1,this.interactive=!1,this.speed=0,this.targetY=0}launch(t,e,s=2){this.x=t,this.y=e,this.speed=s,this.active=!0,this.visible=!0,this.interactive=!0,this.targetY=e+(Math.random()-.5)*100,this.wobblePhase=Math.random()*Math.PI*2}update(){if(this.active)return this.x-=this.speed,this.wobblePhase+=.05,this.y=this.targetY+Math.sin(this.wobblePhase)*10,this.x<-this.width?(this.deactivate(),!1):!0}deactivate(){this.active=!1,this.visible=!1,this.interactive=!1}}class f{constructor(t,e,s=20){this.ctx=t,this.container=e,this.pool=[],this.activeItems=new Set;const i=t.sets.all.combo.filter(a=>a.recipe&&a.recipe.length>0);if(i.length===0)throw new Error("BAD CONTEXT ITEMS. NO COMPOSITE RECIPES");for(let a=0;a<s;a++){const r=i[a%i.length],h=new d(r);this.container.addChild(h),this.pool.push(h)}}acquire(t,e,s){const i=this.pool.find(a=>!a.active);return i?(i.launch(t,e,s),this.activeItems.add(i),i):null}updateAll(){for(const t of this.activeItems)t.update()||(this.release(t),this.onMiss?.(t))}release(t){t.deactivate(),this.activeItems.delete(t)}checkHit(t){for(const e of this.activeItems)if(e.isMatch(t))return this.release(e),!0;return!1}destroy(){for(const t of this.pool)t.destroy();this.pool=[],this.activeItems.clear()}}class v extends p{constructor(t){super(t),this.pool=new f(t,this.gameAreaContainer),this.pool.onMiss=this.onMiss,this.ctx.app.stage.on("pointerdown",this.onScreenClick,this),this.spawnInterval=setInterval(()=>{this.spawnFlyingItem()},1500),this.ctx.app.ticker.add(this.update,this)}onCombine=t=>{console.log("COMBINED")};onMiss=t=>{this.misses++,this.pool.release(t),this.misses>=10&&this.endGame()};endGame=()=>{console.log("GAMEOVER")};update(){this.pool.updateAll(this.ctx.app.ticker.deltaMS)}spawnFlyingItem(){const t=this.ctx.app.screen.width+50,e=Math.random()*(this.ctx.app.screen.height-200)+100,s=1.5+Math.random()*1.5;this.pool.acquire(t,e,s)}onScreenClick(t){for(const e of this.pool.activeItems){const s=t.global.x-e.x,i=t.global.y-e.y;if(Math.sqrt(s*s+i*i)<30){this.onHit(e);break}}}onHit(t){this.createHitEffect(t.x,t.y),this.collectedItems.push(t.item),this.pool.release(t)}createHitEffect(t,e){const s=new n(c.WHITE);s.tint=65280,s.width=s.height=20,s.position.set(t,e),s.alpha=.8,this.gameAreaContainer.addChild(s),setTimeout(()=>s.destroy(),200)}destroy(){clearInterval(this.spawnInterval),this.ctx.app.stage.off("pointerdown",this.onScreenClick,this),this.ctx.app.ticker.remove(this.update,this),this.pool?.destroy(),super.destroy()}}export{v as default};
